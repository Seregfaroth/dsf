
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="dragit.css" rel="stylesheet"/>
		<script src="pathseg.js"></script>
		<script src="jquery-1.10.2.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="d3.v3.js"></script>
		<script src="dragit.js"></script>
		<title>Northern Waters - West Coast of Scotland - Historical Data and Scenario Model Output</title>
		<style>

			@import url(https://fonts.googleapis.com/css?family=Droid+Serif);
			@import url(https://fonts.googleapis.com/css?family=Open+Sans);

			/*Document style*/
			h1,h2,h3,h4,h5{
				color: #0f334a;
				font-family: 'Droid Serif', Arial, Helvetica, sans-serif;
			}

			p,ul,ol,td,label {
				font-family: 'Open Sans', Arial, Helvetica, sans-serif;
				font-weight: 400;
				font-size: 14px;
				line-height: 20px;
				color: #747474;
				text-align: justify;
			}

			th, strong {
				color: #0f334a;
			}

			body {
				width: 1024px;
				margin: 0 auto;
			}

			html,body {
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;

			}


			label.highlighted{
				background: rgba(0,0,0,0.1);
				border-radius: 3px;
			}

			/* The most incredibly lazy way to get points after the year 2008 to appear differently (historic vs simulated)*/
			.best-case-scenario
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory +
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory +
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory +
			.pointTrajectory +
			.pointTrajectory +
			.pointTrajectory +
			.pointTrajectory {
				fill: #C00;
				stroke-width: 0px;
			}

			text {
				cursor: default;
			}

			#chart {
				height: 506px;
			}

			text {
				font-size: 10px;
			}

			.dot, .point {
				stroke: #000;
			}

			.point {
				opacity: 0.5;
			}

			.axis path, .axis line {
				fill: none;
				stroke: #000;
				shape-rendering: crispEdges;
			}

			.label {
				fill: #777;
			}

			.year.label {
				font: 500 196px 'Droid Serif';
				fill: #ddd;
			}

			.x.label, .y.label {
				font-size: 14px;
				text-shadow: 0 0 2px rgba(255, 255, 255, 1), 0 0 2px rgba(255, 255, 255, 1), 0 0 2px rgba(255, 255, 255, 1);
			}

			.country.label  {
				font: 500 96px 'Droid Serif';
				fill: #ddd;
			}

			.year.label.active {
				fill: #aaa;
			}

			.tooltip-box {
				padding: 4px;
				background: #FFF;
				z-index: 1000;
				position: absolute;
				pointer-events:none;
				border-radius: 4px;
				border: 1px solid #CCC;
				font-size: 10px;
			}

			circle.pointTrajectory {
				pointer-events: none;
				stroke: lightgray;
				fill: none;
				opacity: 1;
				stroke-width: 0px;
				pointer-events:none;
			}

			.gDragit {
				pointer-events:none;
			}

			path.lineTrajectory {
				stroke-linejoin: round;
				stroke-width: 3;
				stroke-opacity: .5;
				stroke: black;
				fill: none;
				pointer-events: none;
			}

			#timeline, #scatter{
				height: 560px;
			}


			path.line {
				stroke-linejoin: round;
				stroke-width: 3;
				stroke-opacity: .7;
				stroke: black;
				fill: none;
			}
			
			span[name="Grey seals"]{ font-weight: 700; color: #0099C6; }
			span[name="Harbour seals"]{ font-weight: 700; color: #DD4477; }
			span[name="Cetaceans"]{ font-weight: 700; color: #66AA00; }
			span[name="Seabirds"]{ font-weight: 700; color: #B82E2E; }
			span[name="Poor cod"]{ font-weight: 700; color: #316395; }
			span[name="Large zooplankton"]{ font-weight: 700; color: #3366CC; }
			span[name="Small zooplankton"]{ font-weight: 700; color: #990099; }
			span[name="Infauna"]{ font-weight: 700; color: #DC3912; }
			span[name="Algae"]{ font-weight: 700; color: #FF9900; }
			span[name="Phytoplankton"]{ font-weight: 700; color: #109618; }
			span[name="Detritus"]{ font-weight: 700; color: black; }

			path.line[name="Grey seals"]{ stroke: #0099C6; }
			path.line[name="Harbour seals"]{ stroke: #DD4477; }
			path.line[name="Cetaceans"]{ stroke: #66AA00; }
			path.line[name="Seabirds"]{ stroke: #B82E2E; }
			path.line[name="Poor cod"]{ stroke: #316395; }
			path.line[name="Large zooplankton"]{ stroke: #3366CC; }
			path.line[name="Small zooplankton"]{ stroke: #990099; }
			path.line[name="Infauna"]{ stroke: #DC3912; }
			path.line[name="Algae"]{ stroke: #FF9900; }
			path.line[name="Phytoplankton"]{ stroke: #109618; }

			.selected {
				stroke-width: 4;
			}

			button.icon:hover {
				background-color: #DDD;
			}

			.icon {
				border:none;
				background: none;
				width:21px;
				height:21px;
				display:inline-block;
				background-size:cover;
			}

			.icon.icon-play {
				background-image:url('img/ic_play_arrow_black_24px.svg');
				opacity: 0.7;
			}
			.icon.icon-play[disabled] {
				opacity: 0.3;
			}
			.icon.icon-pause {
				background-image:url('img/ic_pause_black_24px.svg');
				opacity: 0.7;
			}
			.icon.icon-reset {
				background-image:url('img/ic_skip_previous_black_24px.svg');
				opacity: 0.7;
			}

			input[type="range"] {
				cursor:pointer;
			}

		</style>
	</head>
	<body class="best-case-scenario" style="background: rgba(41,137,202,1);">
		<div style="background: #FFF;
		     width: 1024px; padding: 20px">
			<h1><a href="../west-coast-of-scotland.html">&lsaquo; Case Study: West Coast of Scotland</a></h1>
			<h2>Historical Data and Scenario Model Output with confidence interval</h2>
			<div class="tooltip-box" style="display:none;">
			</div>
			<div class="text-right">
				<h3><a href="scatter-beta-4.html">To return to timeline click here</a></h3>
			</div>			
			<hr>
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" class="active"><a href="scatter-beta-confidence-2.html#timeline" aria-controls="timeline" role="tab" data-toggle="tab">Timeline Scenarios</a></li>
			</ul>
			<div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="timeline">
					<div id="chart_timeline" style="margin:0px"></div>
					<div>
						<div style="width:39px;height:20px;display:table-cell;"></div>
						<div style="width:437px;background:#EEE;height:20px;border-right: 1px dashed;vertical-align: bottom;display:table-cell;padding:5px;text-align:center;font-weight:700;font-size:12px;">Historical data</div>
						<div style="width:505px;background: repeating-linear-gradient(
							45deg,
							#F8F8F8,
							#F8F8F8 3px,
							#EEE 3px,
							#EEE 6px
							);height:20px;vertical-align: bottom;display:table-cell;padding:5px;text-align:center;font-weight:700;font-size:12px;">
							Simulated data:<select class="" style="z-index:1;" id="select-scenario">
								<!-- <option value="dataFeb2017/Algae.biomass.json">Algae - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Blue.Whiting.biomass.json">Blue.Whiting - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Cephalopod.biomass.json">Cephalopod - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Cetaceans.biomass.json">Cetaceans - Y=biomass (tons)</option> -->
								<option value="dataFeb2017/Cod.mature" selected="selected">Cod mature</option>
								<option value="dataFeb2017/Cod.immature">Cod immature</option>
								<!-- <option value="dataFeb2017/Crustaceans.biomass.json">Crustaceans - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Edible.crab.biomass.json">Edible.crab - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Epifauna.biomass.json">Epifauna - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Flatfish.biomass.json">Flatfish - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Flatfish.profit.json">Flatfish - Y=profit (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Flatfish.catch.json">Flatfish - Y=catch (tons)</option> -->
								<!-- <option value="dataFeb2017/Flatfish.value.json">Flatfish - Y=value (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Grey.seals.biomass.json">Grey.seals - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Gurnards.biomass.json">Gurnards - Y=biomass (tons)</option> -->
								<option value="dataFeb2017/Haddock.mature">Haddock mature</option>
								<option value="dataFeb2017/Haddock.immature">Haddock immature</option>
								<!-- <option value="dataFeb2017/Harbour.seals.biomass.json">Harbour.seals - Y=biomass (tons)</option> -->
								<option value="dataFeb2017/Herring">Herring</option>
								<!-- <option value="dataFeb2017/Horse.Mackerel.biomass.json">Horse.Mackerel - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Infauna.biomass.json">Infauna - Y=biomass (tons)</option> -->
								<option value="dataFeb2017/Large.demersals">Large demersals</option>
								<!-- <option value="dataFeb2017/Large.zooplankton.biomass.json">Large.zooplankton - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Lobster.biomass.json">Lobster - Y=biomass (tons)</option> -->
								<option value="dataFeb2017/Mackerel">Mackerel</option>
								<option value="dataFeb2017/Monkfish">Monkfish</option>
								<option value="dataFeb2017/Nephrops">Nephrops</option>
								<!-- <option value="dataFeb2017/Norway.pout.biomass.json">Norway.pout - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Norway.pout.profit.json">Norway.pout - Y=profit (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Norway.pout.catch.json">Norway.pout - Y=catch (tons)</option> -->
								<!-- <option value="dataFeb2017/Norway.pout.value.json">Norway.pout - Y=value (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Other.pelagics.biomass.json">Other.pelagics - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Other.small.fish.biomass.json">Other.small.fish - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Other.small.fish.profit.json">Other.small.fish - Y=profit (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Other.small.fish.catch.json">Other.small.fish - Y=catch (tons)</option> -->
								<!-- <option value="dataFeb2017/Other.small.fish.value.json">Other.small.fish - Y=value (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Phytoplankton.biomass.json">Phytoplankton - Y=biomass (tons)</option> -->
								<option value="dataFeb2017/Pollock">Pollock</option>
								<!-- <option value="dataFeb2017/Poor.cod.biomass.json">Poor.cod - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Rays.biomass.json">Rays - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Rays.profit.json">Rays - Y=profit (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Rays.catch.json">Rays - Y=catch (tons)</option> -->
								<!-- <option value="dataFeb2017/Rays.value.json">Rays - Y=value (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Sandeel.biomass.json">Sandeel - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Sandeel.profit.json">Sandeel - Y=profit (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Sandeel.catch.json">Sandeel - Y=catch (tons)</option> -->
								<!-- <option value="dataFeb2017/Sandeel.value.json">Sandeel - Y=value (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Scallops.biomass.json">Scallops - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Seabirds.biomass.json">Seabirds - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Sharks.biomass.json">Sharks - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Sharks.profit.json">Sharks - Y=profit (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Sharks.catch.json">Sharks - Y=catch (tons)</option> -->
								<!-- <option value="dataFeb2017/Sharks.value.json">Sharks - Y=value (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Small.zooplankton.biomass.json">Small.zooplankton - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Sprat.biomass.json">Sprat - Y=biomass (tons)</option> -->
								<!-- <option value="dataFeb2017/Sprat.profit.json">Sprat - Y=profit (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Sprat.catch.json">Sprat - Y=catch (tons)</option> -->
								<!-- <option value="dataFeb2017/Sprat.value.json">Sprat - Y=value (€ x 1000)</option> -->
								<!-- <option value="dataFeb2017/Velvet.crab.biomass.json">Velvet.crab - Y=biomass (tons)</option> -->
								<option value="dataFeb2017/Whiting.mature">Whiting mature</option>
								<option value="dataFeb2017/Whiting.immature">Whiting immature</option>
									
							</select></div>
					</div>
					<div>
						<div style="width:39px;height:20px;display:table-cell;"></div>
						<div style="background:#F8F8F8;width:942px;height:20px;display:table-cell;padding:5px;text-align:center;font-weight:700;font-size:12px;">
							y-axis: 
							<select class="" style="z-index:1;" id="select-y-axis">
								<option value="biomass">Biomass (1000t)</option>
								<option value="catch">Catch (1000t)</option>
								<option value="profit">Profit ('000s of €)</option>
								<option value="value">Value ('000s of €)</option>
							</select>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<label for="confidenceint">
								<input id="confidenceint" type="checkbox" name="confidenceint" checked="checked"> Show confidence intervals
							</label>
						</div>
					</div>
				</div>
			</div>
			<div class="container-fluid">
				<div class="row">
					<div class="col-xs-12">
						<br />
						<div id="theText" class="text-center" style="font-weight:700;font-size:15px;">
							&nbsp;
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-5">
						<h3>Scenarios
							<div class="pull-right">
								<button class="btn btn-xs btn-default select-all" value="Fish">Select All</button>
								<button class="btn btn-xs btn-default deselect-all" value="Fish">Deselect All</button>
							</div>
						</h3>
						<div class="container-fluid">
							<div class="row" id="fishchecks">
								<div class="col-xs-6">
									<div class="checkbox">
										<label><input type="checkbox" autocomplete="off" checked value="Fmey"/>Fmey</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="Fmsy"/>Fmsy</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="Fmsy+Cod"/>Fmsy+Cod</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="Fmsy+SealCull"/>Fmsy+SealCull</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="Fmsy+SealCull+Cod"/>Fmsy+SealCull+Cod</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="spatialF"/>spatialF</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="status_quo"/>status_quo</label><br/>
									</div>
								</div>
								<div class="col-xs-6">
									<div class="checkbox">
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xs-7">
						<div class="container-fluid">
						</div>
					</div>
				</div>
			</div>
		</div>
		<br>
		<!--<p>
		Original creation by <a href="http://www.gapminder.org/world/">Gapminder</a> using <a href="https://github.com/RandomEtc/mind-gapper-js">Tom Carden</a> JavaScript version.<br>
		Recreation by <a href="http://bost.ocks.org/mike/nations/">Mike Bostock</a> with <a href="http://d3js.org/">D3.js</a>.<br>
		Re-Recreation using <a href="http://romsson.github.io/dragit/">dragit.js</a> by <a href="http://romain.vuillemot.net/">Romain Vuillemot</a> (view <a href="https://github.com/romsson/dragit/blob/master/example/nations.html">source</a> on GitHub).-->

		<script>
		// Various accessors that specify the four dimensions of data to visualize.
			function x(d) {
				return d.dataset;
			}
			function y(d) {
				return d.landings;
			}
			function radius(d) {
				return d.value;
			}
			function color(d) {
				return d.region;
			}
			function key(d) {
				return d.name;
			}
			var selected_y_axis = "dataset";
			var speed = 10;
			var playing = false;
			var externallink;
			var cached = false;
			var cached_interpolatedData = {};

			function randomize_dataset() {
				if (externallink) {
					for (var i = 0; i < externallink.length; i++) {
						for (var u = 0; u < externallink[i].biomass.length; u++) {
							externallink[i].biomass[u][1] = externallink[i].biomass[u][1] * (Math.random() * 0.2 + 0.9);
							externallink[i].landings[u][1] = externallink[i].landings[u][1] * (Math.random() * 0.2 + 0.9);
							externallink[i].value[u][1] = externallink[i].value[u][1] * (Math.random() * 0.2 + 0.9);
						}
					}
				}
			}

			var whoah;
		// Chart dimensions.
			var margin = {top: 19.5, right: 19.5, bottom: 19.5, left: 69.5},
			width = 930 - margin.right,
				height = 500 - margin.top - margin.bottom;

		// Various scales. These domains make assumptions of data, naturally.
			var xScale = d3.scale.linear().domain([0.00000, 1700000]).range([0, width]),
				yScale = d3.scale.linear().domain([0.00000, 350000]).range([height, 0]),
				radiusScale = d3.scale.sqrt().domain([0, 100]).range([1, 10]),
				colorScale = d3.scale.category20();

		// The x & y axes.
			var xAxis = d3.svg.axis().orient("bottom").scale(xScale),
				yAxis = d3.svg.axis().scale(yScale).orient("left");

		// Create the SVG container and set the origin.
			var svg = d3.select("#chart").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
				.attr("class", "gRoot")

		// Add the x-axis.
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

		// Add the y-axis.
			svg.append("g")
				.attr("class", "y axis")
				.call(yAxis);

		// Add an x-axis label.
			var svg_x_axis_label = svg.append("text")
				.attr("class", "x label")
				.attr("text-anchor", "end")
				.attr("x", width)
				.attr("y", height - 6)
				.text("Biomass (tons"); //tons / km
		
			svg_x_axis_label.append("tspan")
				.attr("dy", -5)
				.text(""); //2
			svg_x_axis_label.append("tspan")
				.attr("dy", 5)
				.text(")");

		// Add a message to the top right hand corner of the graph illustrating
		// what the size of the circles represents
			svg.append("text")
				.attr("class", "x label")
				.attr("text-anchor", "end")
				.attr("x", width)
				.attr("y", 0)
				.text("Radii of circles represent value (GBP) of landings");

		// Add a y-axis label.
			var svg_y_axis_label = svg.append("text")
				.attr("class", "y label")
				.attr("text-anchor", "end")
				.attr("y", 6)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text("Landings (tons"); //tons / km

			svg_y_axis_label.append("tspan")
				.attr("dy", -5)
				.text(""); //2
			svg_y_axis_label.append("tspan")
				.attr("dy", 5)
				.text(")");

		// Add the year label; the value is set on transition.
			var label = svg.append("text")
				.attr("class", "year label")
				.attr("text-anchor", "end")
				.attr("y", height - 24)
				.attr("x", width)
				.text(2050);

		// Add the country label; the value is set on transition.
			var countrylabel = svg.append("text")
				.attr("class", "country label")
				.attr("text-anchor", "start")
				.attr("y", 80)
				.attr("x", 20)
				.text(" ");


		// timeline svg
		// Various scales. These domains make assumptions of data, naturally.
			var xScale_t = d3.scale.linear().domain([1985, 2050]).range([0, width]),
				yScale_t = d3.scale.linear().domain([0.00000, 1600000]).range([height, 0]),
				radiusScale_t = d3.scale.sqrt().domain([0, 100]).range([1, 10]),
				colorScale_t = d3.scale.category20();

		// The x & y axes.
			var xAxis_t = d3.svg.axis().orient("bottom").scale(xScale_t).tickFormat(d3.format("d")),
				yAxis_t = d3.svg.axis().scale(yScale_t).orient("left");

			var svg_t = d3.select("#chart_timeline").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
				.attr("class", "gRoot");

		// Add the x-axis.
			svg_t.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis_t);

		// Add the y-axis.
			svg_t.append("g")
				.attr("class", "y axis")
				.call(yAxis_t);

		// Add an x-axis label.
			var svg_t_x_axis_label = svg.append("text")
				.attr("class", "x label")
				.attr("text-anchor", "end")
				.attr("x", width)
				.attr("y", height - 6)
				.text("Biomass (tons"); //tons / km

			svg_t_x_axis_label.append("tspan")
				.attr("dy", -5)
				.text(""); //2
			svg_t_x_axis_label.append("tspan")
				.attr("dy", 5)
				.text(")");

		// Add a y-axis label.
			var svg_t_y_axis_label = svg.append("text")
				.attr("class", "y label")
				.attr("text-anchor", "end")
				.attr("y", 6)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text("Landings (tons"); //tons / km

			svg_t_y_axis_label.append("tspan")
				.attr("dy", -5)
				.text(""); //2
			svg_t_y_axis_label.append("tspan")
				.attr("dy", 5)
				.text(")");

			svg_t.append("svg:line")
				.attr("class", 'd3-dp-line')
				.attr("x1", xScale_t(2014))
				.attr("y1", yScale_t(0))
				.attr("x2", xScale_t(2014))
				.attr("y2", yScale_t(120*70000))
				.style("stroke-dasharray", ("3, 3"))
				.style("stroke-opacity", 0.9)
				.style("stroke", "black");

		// The three graphs below the big one are all quite similar, so I've reduced the code to be a bit more concise
		// with drawing labels etc.
		/*
			var svg_v = d3.select("#chart_vertebates").append("svg")
				.attr("width", 348.219)
				.attr("height", 200)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + 5 + ")")
				.attr("class", "gRoot")
			var xScale_v = d3.scale.linear().domain([1985, 2033]).range([0, 348.219 - margin.right - margin.left + 20]),
				yScale_v = d3.scale.linear().domain([0, 0.15*70000]).range([200 - 5 - margin.bottom, 0])

		// Create the SVG container and set the origin.
			var svg_iv = d3.select("#chart_invertebates").append("svg")
				.attr("width", 348.219)
				.attr("height", 200)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + 5 + ")")
				.attr("class", "gRoot")
			var xScale_iv = d3.scale.linear().domain([1985, 2033]).range([0, 348.219 - margin.right - margin.left + 20]),
				yScale_iv = d3.scale.linear().domain([0, 38*70000]).range([200 - 5 - margin.bottom, 0])

		// Create the SVG container and set the origin.
			var svg_d = d3.select("#chart_detritus").append("svg")
				.attr("width", 348.219)
				.attr("height", 200)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + 5 + ")")
				.attr("class", "gRoot")
			var xScale_d = d3.scale.linear().domain([1985, 2033]).range([0, 348.219 - margin.right - margin.left + 20]),
				yScale_d = d3.scale.linear().domain([0, 200*70000]).range([200 - 5 - margin.bottom, 0])

		// Remove redundant code for the three similar graphs
			var redundant_graphs = [svg_v, svg_iv, svg_d];
			var redundant_graphs_xScale = [xScale_v, xScale_iv, xScale_d];
			var redundant_graphs_yScale = [yScale_v, yScale_iv, yScale_d];
			var redundant_graphs_max = [0.1, 25, 200];
			var redundant_graphs_indicator = [];
			var redundant_graph_y_axis = [];

			for (var i = 0; i < redundant_graphs.length; i++) {

				var redundant_graphs_xAxis = d3.svg.axis().orient("bottom").scale(redundant_graphs_xScale[i]).tickFormat(d3.format("d")),
					redundant_graphs_yAxis = d3.svg.axis().scale(redundant_graphs_yScale[i]).orient("left");

				redundant_graphs[i].append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(-10," + (200 - 5 - margin.bottom) + ")")
					.attr("style", "background:#FFF;")
					.call(redundant_graphs_xAxis);
				// Add the y-axis.
				redundant_graphs[i].append("g")
					.attr("class", "y axis")
					.attr("transform", "translate(-10," + 0 + ")")
					.call(redundant_graphs_yAxis);
				// Add a y-axis label.
				redundant_graph_y_axis[i] = redundant_graphs[i].append("text")
					.attr("class", "y label")
					.attr("text-anchor", "end")
					.attr("y", -4)
					.attr("dy", ".75em")
					.attr("transform", "rotate(-90)")
					.text("Biomass (tons"); //tons / km

				redundant_graph_y_axis[i].append("tspan")
					.attr("dy", -5)
					.text(""); //2

				redundant_graph_y_axis[i].append("tspan")
					.attr("dy", 5)
					.text(")");

				redundant_graphs[i].append("svg:line")
					.attr("class", 'd3-dp-line')
					.attr("transform", "translate(-10,0)")
					.attr("x1", redundant_graphs_xScale[i](2013.5))
					.attr("y1", redundant_graphs_yScale[i](0))
					.attr("x2", redundant_graphs_xScale[i](2013.5))
					.attr("y2", redundant_graphs_yScale[i](redundant_graphs_max[i]))
					.style("stroke-dasharray", ("3, 3"))
					.style("stroke-opacity", 0.9)
					.style("stroke", "black");
				redundant_graphs_indicator.push(redundant_graphs[i].append("svg:line")
					.attr("class", 'd3-dp-line')
					.attr("transform", "translate(-10,0)")
					.attr("x1", redundant_graphs_xScale[i](2033))
					.attr("y1", redundant_graphs_yScale[i](0))
					.attr("x2", redundant_graphs_xScale[i](2033))
					.attr("y2", redundant_graphs_yScale[i](redundant_graphs_max[i]))
					.style("stroke-dasharray", ("1, 1"))
					.style("stroke-opacity", 0.4)
					.style("stroke", "black"));
				var the_correct_graph_scale = redundant_graphs_yScale[i];

				$(redundant_graphs[i][0]).parent().on("mousemove", function (event) {

					var biomass = redundant_graphs_yScale[$(this).data("graph_scale_id")].invert(-($(this).offset().top - event.pageY) - 5);
					if (biomass > 0.0002) {
						$(".tooltip-box").css("left", event.pageX).css("top", event.pageY + 20).show();
						$(".tooltip-box").html(
							parseFloat(biomass).toPrecision(3) + " tons/"
							);
					}
				}).on("mouseleave", function (d, i) {
					$(".tooltip-box").hide();
				}).data("graph_scale_id", i);
			}
			console.log(the_correct_graph_scale)
		*/


			var first_time = true;



			// Load the data.
			//$('#fishchecks input:checkbox').prop('checked', false);
			//$('#fishchecks input:checkbox').trigger('click');
			

			d3.json("dataFeb2017/Cod.mature.biomass.json", function (nations) {

					//disable profit for cod mature
					$("#select-y-axis option[value=profit]").prop('disabled',true);

					// We will no load in three other managent scenarious
					/*d3.json("fish-worst-case.json", function(nations) {

					 });*/

					externallink = nations;

					//var to_add_to_v = ["Grey seals", "Harbour seals", "Cetaceans", "Seabirds", "Poor cod"];
					//var to_add_to_iv = ["Large zooplankton", "Small zooplankton", "Infauna", "Algae", "Phytoplankton"]
					//var to_add_to_d = ["Detritus"]
					//var line_v = [];
					//var line_iv = [];
					//var line_d = [];
					
					for (var i = 0; i < nations.length; i++) {
						for (var u = 0; i, u < nations[i].dataset.length; u++) {
							nations[i].dataset[u][1] = nations[i].dataset[u][1] / 1000.0;
							nations[i].dataset[u][2] = nations[i].dataset[u][2] / 1000.0;
							nations[i].dataset[u][3] = nations[i].dataset[u][3] / 1000.0;
						}
					}

					for (var i = 0; i < nations.length; i++) {
						var svg_ti;
						var xScale_ti;
						var yScale_ti;
						if (1) {
							// Add to the main timeline
							var line = d3.svg.line()
								.x(function (d) {
									return xScale_t(d[0]);
								})
								.y(function (d) {
									return yScale_t(d[1]);
								});
							var d_path = svg_t.insert("path", ":first-child")
								.datum(nations[i].dataset)
								.attr("class", "line line-graph")
								.attr("name", nations[i].name)
								.style("stroke", function (d) {
									return colorScale_t(color(nations[i]));
								})
								.attr("d", line);
						
						
							var confidenceArea = d3.svg.area()
								.interpolate('linear')
								.x(function (d) {
									return xScale_t(d[0]); })
								.y0(function(d) {
									return yScale_t(d[2]); })
								.y1(function(d) {
									return yScale_t(d[3]); });			

							var d_conf = svg_t.insert("path", ":first-child")
								.datum(nations[i].dataset)
								.attr("class", "area confidence")
								.attr("fill", function (d) {
									return colorScale_t(color(nations[i]));
								})
								.attr("stroke-width", "1")
								.attr("stroke", function (d) {
									return colorScale_t(color(nations[i]));
								})
								.attr("stroke-opacity", "0.3")
								.attr("fill-opacity", "0.1")
								.attr("transform", "translate(0," + -10 + ")")
								.attr("name", 'conf_' + nations[i].name)
								.attr("d", confidenceArea);
								//.attr("fill", "#D7191C50")
						
						
							for (var u = 0; i, u < nations[i].dataset.length; u++) {
								var dot = svg_t.append("circle")
									.datum( {i: i, u: u } )
									.attr("class", "point")
									.attr("name", nations[i].name + "-" + nations[i].dataset[u][0])
									.attr("cx", function (d) {
										return xScale_t(nations[i].dataset[u][0]);
									})
									.attr("cy", function (d) {
										return yScale_t(nations[i].dataset[u][1]);
									})
									.attr("r", 2)
									.on("mouseover", function (d) {
										var datum = d3.select(this).datum();
										$(".tooltip-box").css("left", d3.event.pageX).css("top", d3.event.pageY + 20).show();
										
										var dataSetInfo = "<br>Dataset: " + parseFloat((nations[datum.i].dataset[datum.u][1]).toPrecision(3)) + " " + " ";
										
										if ($("#select-y-axis").val() == 'biomass') {
											dataSetInfo = "<br>Biomass: " + parseFloat((nations[datum.i].dataset[datum.u][1]).toFixed(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 't';
										} else if ($("#select-y-axis").val() == 'catch') {
											dataSetInfo = "<br>Catch: " + parseFloat((nations[datum.i].dataset[datum.u][1]).toFixed(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 't';
										} else if ($("#select-y-axis").val() == 'profit') {
											dataSetInfo = "<br>Profit €" + parseFloat((nations[datum.i].dataset[datum.u][1]).toPrecision(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										} else if ($("#select-y-axis").val() == 'value') {
											dataSetInfo = "<br>Value: €" + parseFloat((nations[datum.i].dataset[datum.u][1]).toPrecision(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										}

										$(".tooltip-box").html( 
											nations[datum.i].name +
											"<br>Year: " + parseFloat((nations[datum.i].dataset[datum.u][0])) + " " +
											dataSetInfo 
										);	

									})
									.on("mouseout", function (d) {
										$(".tooltip-box").hide();
									});
							}
							continue;
						}					
						var line = d3.svg.line()
							.x(function (d) {
								return xScale_ti(d[0]);
							})
							.y(function (d) {
								return yScale_ti(d[1]);
							})

						var d_path = svg_ti.insert("path", ":first-child")
							.datum(nations[i].dataset)
							.attr("class", "line line-graph")
							.attr("name", nations[i].name)
							.attr("transform", "translate(-10," + 0 + ")")
							.attr("d", line);

					
						/*
						var d_conf = svg_ti.append("path")
							.attr({
								"class": "area confidence",
								"fill": "#D7191C",
								"d": confidenceArea
							});
						*/
					}

					// A bisector since many nation's data is sparsely-defined.
					var bisect = d3.bisector(function (d) {
						return d[0];
					});

					//console.log(d3.selectAll(".dot").data().property.data);

					
					// Add a dot per nation. Initialize the data at 1800, and set the colors.
					var dot = svg.append("g")
						.attr("class", "dots")
						.selectAll(".dot")
						.data(interpolateData(1985))
						.enter().append("circle")
						.attr("class", "dot")
						.style("fill", function (d) {
							console.log(d);
							return colorScale(color(d));
						})
						.call(position)
						.on("mousedown", function (d, i) {

						})
						.on("mouseup", function (d, i) {
							dot.classed("selected", false);
							d3.select(this).classed("selected", !d3.select(this).classed("selected"));
							dragit.trajectory.display(d, i, "selected");

							//TODO: test if has been dragged
							// Look at the state machine history and find a drag event in it?

						})
						.on("mouseenter", function (d, i) {
							//clear_demo();
							if (dragit.statemachine.current_state == "idle") {
								dragit.trajectory.display(d, i)
								dragit.utils.animateTrajectory(dragit.trajectory.display(d, i), dragit.time.current, 3000)
								countrylabel.text(d.name);
								dot.style("opacity", .4)
								d3.select(this).style("opacity", 1)
								d3.selectAll(".selected").style("opacity", 1)
								//if(){
								//}
							}
							$("input[type='checkbox'][value='" + d.name + "']").parent().addClass("highlighted");
						})
						.on("mousemove", function (d, i, c) {
							$(".tooltip-box").css("left", d3.event.pageX).css("top", d3.event.pageY + 20).show();
							$(".tooltip-box").html(("Value: €" + parseFloat((radius(d) * 1000).toPrecision(3))).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") +
								"<br>Dataset: " + parseFloat((x(d)).toPrecision(3)) + " tons/"
								)
						})
						.on("mouseleave", function (d, i) {
							$(".tooltip-box").hide();
							if (dragit.statemachine.current_state == "idle") {
								countrylabel.text("");
								dot.style("opacity", 1);
							}
							$("input[type='checkbox'][value='" + d.name + "']").parent().removeClass("highlighted");
							//if($(".dot.selected").length>0){
							//while($(".gDragit.selected").length>1){
							//$(".gDragit.selected:last-of-type").remove();
							//}
							//} else {
							d3.selectAll(".gDragit.selected").remove();
							dragit.trajectory.remove(d, i);
							//}
						});
						//.call(dragit.object.activate);
				
					// Add a title.
					dot.attr("name", function (d) {
						return d.name
					});
					//.append("title")
					//.text(function(d) { return d; });


					// Start a transition that interpolates the data based on year.
					svg.transition()
						.duration(30000)
						.ease("linear");

					// Positions the dots based on data.
					function position(dot) {
						dot.transition().duration(speed).ease("linear")
							.attr("cx", function (d) {
								return xScale(x(d));
							})
							.attr("cy", function (d) {
								return yScale(y(d));
							})
							.attr("r", function (d) {
								return radiusScale(radius(d));
							});

						dot.select("title").text(function (d) {
							return ("€" + parseFloat((radius(d) * 1000).toPrecision(3))).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
						})
					}

					// Defines a sort order so that the smallest dots are drawn on top.
					function order(a, b) {
						return radius(b) - radius(a);
					}

					// Updates the display to show the specified year.
					function displayYear(year) {
						dot.data(interpolateData(year), key).call(position).sort(order);
						label.text(Math.floor(year));
						/*
						for (var i = 0; i < redundant_graphs_indicator.length; i++) {
							redundant_graphs_indicator[i].transition().duration(speed).ease("linear").attr("x1", redundant_graphs_xScale[i](year)).attr("x2", redundant_graphs_xScale[i](year));
						}
						*/
					}

					// Interpolates the dataset for the given (fractional) year.
					function interpolateData(year) {
						//console.log(year)
						if (cached) {
							return cached_interpolatedData[year];
						} else {
							for (var i = 1985; i <= 2050; i++) {
								cached_interpolatedData[i] = nations.map(function (d) {
									//var test = interpolateValues(d.value, i);
									//if (test == 100) console.log(d.name);
									return {
										name: d.name,
										region: d.region,
										dataset: interpolateValues(d.dataset, i)
									};
								});
							}
							cached = true;
							return cached_interpolatedData[year];
						}
					}

					// Finds (and possibly interpolates) the value for the specified year.
					function interpolateValues(values, year) {

						var i = bisect.left(values, year, 0, values.length - 1),
							a = values[i];
						if (typeof(a) == 'undefined') {
							console.log("interpolateValues could find no values for the year:" + year);
							return 0;
						}
						if (i > 0) {
							var b = values[i - 1],
								t = (year - a[0]) / (b[0] - a[0]);
							return a[1] * (1 - t) + b[1] * t;
						}
						return a[1];
					}



					init();

					function update(v, duration) {
						dragit.time.current = v || dragit.time.current;
						displayYear(1985 + dragit.time.current)
						d3.select("#slider-time").property("value", 1985 + dragit.time.current);
					}

					function init() {

						dragit.init("#chart .gRoot");

						dragit.time = {min: 1985, max: 2050, step: 1, current: 2050}
						dragit.data = d3.range(nations.length).map(function () {
							return Array();
						})

						nations.map(function (d) {
							if (d.name == "Grey seals" || d.name == "Harbour seals" || d.name == "Cetaceans" || d.name == "Seabirds" || d.name == "Poor cod" || d.name == "Large zooplankton" || d.name == "Small zooplankton" || d.name == "Infauna" || d.name == "Algae" || d.name == "Phytoplankton" || d.name == "Detritus") {
								$(".dot[name='" + d.name + "']").each(function () {
									$(this).attr("class", $(this).attr("class") + " hidden");
								});
							}
						});

						for (var yy = 1985; yy < 2051; yy++) {

							interpolateData(yy).filter(function (d, i) {
								dragit.data[i][yy - dragit.time.min] = [xScale(x(d)), yScale(y(d))];

							})
						}

						dragit.evt.register("update", update);

						d3.select("#slider-time").property("value", dragit.time.current);

						d3.select("#slider-time")
							.on("input", function () {
								displayYear(parseInt(this.value), 500);
								clear_demo();
							})
							.on("change", function () {
								displayYear(parseInt(this.value), 500);
								clear_demo();
							})
							.on("mousedown", function () {
								speed = 10;
								$(".icon-pause").click();
							})

						d3.selectAll(".dot")
							.on("mousedown", function () {
								speed = 10;
								$(".icon-pause").click();
							})

						d3.select("#select-scenario")
							.on("change", function () {
								console.log("there was an input!")
								
								//if ($("#select-y-axis").val() == 'profit') {
									if (['dataFeb2017/Herring', 'dataFeb2017/Mackerel'].indexOf($(this).val()) != -1) {
										$("#select-y-axis option[value=profit]").prop('disabled',false);
									} else {
										if ($("#select-y-axis").val() == 'profit') {
											$("#select-y-axis").val('biomass');
										}
										$("#select-y-axis option[value='profit']").prop('disabled',true);
									}
								//}
								
								var theinputfile = $(this).val() + '.' +  $("#select-y-axis").val() + '.json';
								console.log(theinputfile);
						
								d3.json(theinputfile, function (new_nations) {
									cached = false;
									nations = new_nations;
									
									for (var i = 0; i < nations.length; i++) {
										for (var u = 0; i, u < nations[i].dataset.length; u++) {
											nations[i].dataset[u][1] = nations[i].dataset[u][1] / 1000.0;
											nations[i].dataset[u][2] = nations[i].dataset[u][2] / 1000.0;
											nations[i].dataset[u][3] = nations[i].dataset[u][3] / 1000.0;
										}
									}
									
									//rescaleGraph();
									//rescaleBiomassGraphs();
									rescaleTimelineGraph();
								});
								//$("#select-scenario-scatter").val($("#select-scenario").val());
								
									
								updateInfo(theinputfile);
							});

						d3.select("#select-scenario-scatter")
							.on("change", function () {
								console.log("there was an input!")
								d3.json($(this).val(), function (new_nations) {
									cached = false;
									nations = new_nations;
									
									for (var i = 0; i < nations.length; i++) {
										for (var u = 0; i, u < nations[i].dataset.length; u++) {
											nations[i].dataset[u][1] = nations[i].dataset[u][1] / 1000.0;
											nations[i].dataset[u][2] = nations[i].dataset[u][2] / 1000.0;
											nations[i].dataset[u][3] = nations[i].dataset[u][3] / 1000.0;
										}
									}
									
									//rescaleGraph();
									//rescaleBiomassGraphs();
									rescaleTimelineGraph();
								});
								$("#select-scenario").val($("#select-scenario-scatter").val());
								updateInfo($(this).val());
							});

						d3.select("#select-y-axis")
							.on("change", function () {
								//selected_y_axis = $(this).val();
								var theinputfile = $("#select-scenario").val() + '.' +  $(this).val() + '.json';
								
								d3.json(theinputfile, function (new_nations) {
									cached = false;
									nations = new_nations;
									
									for (var i = 0; i < nations.length; i++) {
										for (var u = 0; i, u < nations[i].dataset.length; u++) {
											nations[i].dataset[u][1] = nations[i].dataset[u][1] / 1000.0;
											nations[i].dataset[u][2] = nations[i].dataset[u][2] / 1000.0;
											nations[i].dataset[u][3] = nations[i].dataset[u][3] / 1000.0;
										}
									}
									
									//rescaleGraph();
									//rescaleBiomassGraphs();
									rescaleTimelineGraph();
								});
								
								updateInfo(theinputfile);
							});

						d3.select("#confidenceint")
							.on("change", function () {
								toggle_confidence($(this).is(':checked'));
							});
						


						var end_effect = function () {
							countrylabel.text("");
							dot.style("opacity", 1)
						}

						dragit.evt.register("dragend", end_effect);

						var show_nation = function (nation) {
							$(".dot[name='" + nation + "']").each(function () {
								$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
							});
							$(".line[name='" + nation + "']").each(function () {
								$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
							});
							if ($("#confidenceint").is(':checked')) {
								$(".area[name='conf_" + nation + "']").each(function () {
									$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
								});
							}
							$(".point[name^='" + nation + "-']").each(function () {
								$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
							});
							/*
							$(".dot[name='two_" + nation + "']").each(function () {
								$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
							});
							$(".line[name='two_" + nation + "']").each(function () {
								$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
							});
							$(".point[name^='two_" + nation + "']").each(function () {
								$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
							});
							*/
						}

						var hide_nation = function (nation) {
							$(".dot[name='" + nation + "']").each(function () {
								if ($(this).attr("class").indexOf("hidden") == -1)
									$(this).attr("class", $(this).attr("class") + " hidden");
							});
							$(".line[name='" + nation + "']").each(function () {
								if ($(this).attr("class").indexOf("hidden") == -1)
									$(this).attr("class", $(this).attr("class") + " hidden");
							});
							
							$(".area[name='conf_" + nation + "']").each(function () {
								if ($(this).attr("class").indexOf("hidden") == -1)
									$(this).attr("class", $(this).attr("class") + " hidden");
							});
							
							$(".point[name^='" + nation + "-']").each(function () {
								if ($(this).attr("class").indexOf("hidden") == -1)
									$(this).attr("class", $(this).attr("class") + " hidden");
							});
							/*
							$(".dot[name='two_" + nation + "']").each(function () {
								if ($(this).attr("class").indexOf("hidden") == -1)
									$(this).attr("class", $(this).attr("class") + " hidden");
							});
							$(".line[name='two_" + nation + "']").each(function () {
								if ($(this).attr("class").indexOf("hidden") == -1)
									$(this).attr("class", $(this).attr("class") + " hidden");
							});
							$(".point[name^='two_" + nation + "']").each(function () {
								if ($(this).attr("class").indexOf("hidden") == -1)
									$(this).attr("class", $(this).attr("class") + " hidden");
							});
							*/
						}
						

						var toggle_confidence = function (val) {
							if (val) {
								//need to do this for active scenarios only
								$('#fishchecks input:checkbox:checked').each(function() {
									//console.log($(this).val());
									$(".area[name='conf_" + $(this).val() + "']").each(function () {
										$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
									});
								});
								
							} else {
								$(".area[name^='conf_']").each(function () {
									if ($(this).attr("class").indexOf("hidden") == -1)
										$(this).attr("class", $(this).attr("class") + " hidden");
								});
							}
						}

						var rescaleBiomassGraphs = function () {

							var graphs = [svg_v, svg_iv, svg_d];
							var graphs_xscale = [xScale_v, xScale_iv, xScale_d];
							var graphs_yscale = [yScale_v, yScale_iv, yScale_d];

							for (var g = 0; g < graphs.length; g++) {
								var line = d3.svg.line()
									.x(function (d) {
										return graphs_xscale[g](d[0]);
									})
									.y(function (d) {
										return graphs_yscale[g](d[1]);
									});

								var paths = graphs[g].selectAll("path.line").datum(function () {

									var name_to_lookup = d3.select(this).attr("name");
									for (var i = 0; i < nations.length; i++) {
										if (nations[i].name == name_to_lookup) {
											return nations[i].biomass;
										}
									}
								}).transition().duration(speed).attr('d', line);
							}
						}

						var rescaleTimelineGraph = function () {
							// calculate the maximum 
							var max_y = 0.001;
							var min_y = 0.000;
							for (var i = 0; i < nations.length; i++) {
								if (0 && $(".dot[name='" + nations[i].name + "']").attr("class").indexOf(" hidden") >= 0) {
									//console.log("ignored!")
								} else {
									for (var u = 0; u < nations[i][selected_y_axis].length; u++) {									
										console.log("count");
										if (nations[i][selected_y_axis][u][1] > max_y) {
											max_y = nations[i][selected_y_axis][u][1];
										}
										//confidence upper value
										if (nations[i][selected_y_axis][u][3] > max_y) {
											max_y = nations[i][selected_y_axis][u][3];
										}
										
										
										if (nations[i][selected_y_axis][u][1] < min_y) {
											min_y = nations[i][selected_y_axis][u][1];
										}
										//confidence lower value
										if (nations[i][selected_y_axis][u][2] < min_y) {
											min_y = nations[i][selected_y_axis][u][2];
										}
										
									}
								}
							}


							console.log("max_y:" + max_y);
							// change the scale
							yScale_t = d3.scale.linear().domain([min_y, max_y]).range([height, 0]);
							yAxis_t = d3.svg.axis().scale(yScale_t).orient("left");
							svg_t.selectAll("g.y.axis").transition().duration(speed).ease("linear").call(yAxis_t);
							// arrange the dots
							for (var i = 0; i < nations.length; i++) {
								for (var u = 0; u < nations[i][selected_y_axis].length; u++) {
									svg_t.selectAll(".point[name='" + nations[i].name + "-" + nations[i][selected_y_axis][u][0] + "']")
										.transition().duration(1000).ease("linear")
										.attr("cy", (yScale_t(nations[i][selected_y_axis][u][1])))
								}
							}
							/*
							for (var i = 0; i < nations_two.length; i++) {
								for (var u = 0; u < nations_two[i][selected_y_axis].length; u++) {
									svg_t.selectAll(".point[name='two_" + nations_two[i].name + "-" + nations_two[i][selected_y_axis][u][0] + "']")
										.transition().duration(1000).ease("linear")
										.attr("cy", (yScale_t(nations_two[i][selected_y_axis][u][1])))
								}
							}
							*/
							// arrange the lines
							/*
							for (var i = 0; i < nations.length; i++) {
								var line = d3.svg.line()
									.y(function (d) {
										return yScale_t(d[1]);
									});
								var d_path = svg_t.selectAll(".line[name='" + nations[i].name + "']")
									.datum(nations[i][selected_y_axis])
									.transition().duration(10000).ease("linear")
									.attr("d", line);
								console.log("lines...");
							} */

							for (var i = 0; i < nations.length; i++) {
								var line = d3.svg.line()
									.x(function (d) {
										return xScale_t(d[0]);
									})
									.y(function (d) {
										return yScale_t(d[1]);
									});
								var d_path = svg_t.selectAll(".line[name='" + nations[i].name + "']")
									.datum(nations[i][selected_y_axis])
									.transition().duration(1000).ease("linear")
									.attr("d", line);
							
							
								var confidenceArea = d3.svg.area()
									 .interpolate('linear')
									 .x(function (d) {
										 return xScale_t(d[0]); })
									 .y0(function(d) {
										 return yScale_t(d[2]); })
									 .y1(function(d) {
										 return yScale_t(d[3]); });			

								var d_path = svg_t.selectAll(".area[name='conf_" + nations[i].name + "']")
									.datum(nations[i][selected_y_axis])
									.transition().duration(1000).ease("linear")
									.attr("d", confidenceArea);
								
							
							}	
							
							
							/*
							for (var i = 0; i < nations_two.length; i++) {
								var line = d3.svg.line()
									.x(function (d) {
										return xScale_t(d[0]);
									})
									.y(function (d) {
										return yScale_t(d[1]);
									});
								var d_path = svg_t.selectAll(".line[name='two_" + nations_two[i].name + "']")
									.datum(nations_two[i][selected_y_axis])
									.transition().duration(1000).ease("linear")
									.attr("d", line);
							}	
							*/
						   

						}

						var rescaleGraph = function () {
							speed = 1000;
							var max_x = 0.02;
							var max_y = 0.001;
							var max_r = 0.001;

							for (var yy = 1985; yy <= 2050; yy++) {
								interpolateData(yy).filter(function (d, i) {
									//console.log($(".dot[name='"+d.name+"']").attr("class"));
									if (0 && $(".dot[name='" + d.name + "']").attr("class").indexOf(" hidden") >= 0) {
										//console.log("ignored!")
									} else {
										if (x(d) > max_x)
											max_x = x(d);
										if (y(d) > max_y)
											max_y = y(d);
										if (radius(d) > max_r)
											max_r = radius(d);
									}
									//dragit.data[i][yy-dragit.time.min] = [xScale(x(d)), yScale(y(d))];
								});
							}
							xScale = d3.scale.linear().domain([0.0000, max_x]).range([0, width]);
							yScale = d3.scale.linear().domain([0.0000, max_y]).range([height, 0]);
							radiusScale = d3.scale.sqrt().domain([0, max_r]).range([3, 30]);
							xAxis = d3.svg.axis().orient("bottom").scale(xScale);
							yAxis = d3.svg.axis().scale(yScale).orient("left")
							svg.selectAll("g.x.axis").transition().duration(speed).ease("linear").call(xAxis);
							svg.selectAll("g.y.axis").transition().duration(speed).ease("linear").call(yAxis);
							for (var yy = 1985; yy <= 2050; yy++) {

								interpolateData(yy).filter(function (d, i) {
									dragit.data[i][yy - dragit.time.min] = [xScale(x(d)), yScale(y(d))];

								})
							}
							d3.selectAll(".gDragit.selected").remove();
							//displayYear(parseInt(d3.select("#slider-time").property("value")), 0);
							setTimeout(function () {
								speed = 10;
							}, 1000);
						}

						//whoah = rescaleGraph;
						//whoah2 = rescaleBiomassGraphs;

						d3.selectAll("button.deselect-all,button.select-all").on("click", function () {
							var select = [];
							if ($(this).val() == "Fish") {
								select = ["Fmey",
									"Fmsy",
									"Fmsy+Cod",
									"Fmsy+SealCull",
									"Fmsy+SealCull+Cod",
									"spatialF",
									"status_quo"];
							} 
							for (var i = 0; i < select.length; i++) {
								if ($(this).hasClass("deselect-all")) {
									$("input[type='checkbox'][value='" + select[i] + "']").prop('checked', false);
									hide_nation(select[i]);
								} else {
									$("input[type='checkbox'][value='" + select[i] + "']").prop('checked', true);
									show_nation(select[i]);
								}
							}
							//rescaleGraph();
							rescaleTimelineGraph();
						});

						d3.selectAll("input[type='checkbox']").on("click", function () {
							if ($(this).is(':checked')) {
								show_nation($(this).val());
							} else {
								hide_nation($(this).val());
							}
							//rescaleGraph();
							rescaleTimelineGraph();
						});

						$("input[type='checkbox']").parent()
							.on("mouseenter", function () {
								var m = document.createEvent('Event');
								m.initEvent('mouseenter', true, true);
								//$(".dot[name='" + $(this).find("input[type='checkbox']").val() + "']")[0].dispatchEvent(m);
							})
							.on("mouseleave", function () {
								var m = document.createEvent('Event');
								m.initEvent('mouseleave', true, true);
								//$(".dot[name='" + $(this).find("input[type='checkbox']").val() + "']")[0].dispatchEvent(m);
							});

						function clearFish() {
							select = ["Fmey",
										"Fmsy",
										"Fmsy+Cod",
										"Fmsy+SealCull",
										"Fmsy+SealCull+Cod",
										"spatialF",
										"status_quo"
									];

							for (var i = 0; i < select.length; i++) {
								$("input[type='checkbox'][value='" + select[i] + "']").prop('checked', false);
								hide_nation(select[i]);
							}
							//rescaleGraph();
							//rescaleTimelineGraph();		
						}						

						//rescaleGraph();
						//rescaleBiomassGraphs();
						rescaleTimelineGraph();
						clearFish();
						updateInfo($('#select-scenario :selected').val());
					}

					function updateInfo(selectval) {
						var theText = "";
						switch (selectval) {
							case 'current_path_good.json':
								theText = "Current path: F at Fmsy for all groups with values (assuming Pollock ~ saithe and large demersals ~ hake). Fmsy values used are attached";
								break;
							case 'cod_recovery_good.json':
								theText = "Cod_R: Fmsy as above + F for cod adult reduced to 0.05 (instead of Fmsy of 0.19)";
								break;
							case 'mix_MEY_good.json':
								theText = "MixMEY: Fmsy as above + F for groups fished by NTR increased by 20% and groups fished by PTR increased by 30% (20 and 30% values identified via previous simulations)";
								break;
							case 'seal_cull_cod_recovery_good.json':
								theText = "Seal_Cull+Cod_R: combination of two scenarios above";
								break;
							case 'seal_cull_good.json':
								theText = "Seal_Cull: Fmsy as above + cull of 10% of grey seal population every year";
								break;
							case 'spatial_F_good.json':
								theText = "Spatial_F: proxy for stocks targeted by area (to recover cod and whiting whilst avoiding discards) based on analyses of survey spatial distributions. Saithe, hake and monkfish located on the shelf edge are all targeted at the lowest Fmsy between the three (i.e. Fmsy=0.19 for monkfish). Cod, haddock and whiting located on the shelf are all targeted at F=0.05 unless F status_quo is already at or below this value (assuming to be residual F when stocks aren’t targeted based on current exploitation rate observed on whiting).";
								break;
							case 'status_quo_good.json':
								theText = "Status_quo: F at F2013 for all groups";
								break;
							default: 
								theText = ""; //selectval;
						}

						$('#theText').html(theText);

					}


				});

		</script>
	</body>
</html>
