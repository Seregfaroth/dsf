
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="dragit.css" rel="stylesheet"/>
		<script src="pathseg.js"></script>
		<script src="jquery-1.10.2.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="d3.v3.js"></script>
		<script src="d3-queue.min.js"></script>
		<script src="dragit.js"></script>
		<script src="js/jquery.floatThead.min.js"></script>
		<title>Baltic Sea - Historical Data and Scenario Model Output</title>
		<style>

			@import url(https://fonts.googleapis.com/css?family=Droid+Serif);
			@import url(https://fonts.googleapis.com/css?family=Open+Sans);

			/*Document style*/
			h1,h2,h3,h4,h5{
				color: #0f334a;
				font-family: 'Droid Serif', Arial, Helvetica, sans-serif;
			}

			p,ul,ol,td,label {
				font-family: 'Open Sans', Arial, Helvetica, sans-serif;
				font-weight: 400;
				font-size: 14px;
				line-height: 20px;
				color: #747474;
				text-align: justify;
			}

			th, strong {
				color: #0f334a;
			}

			body {
				width: 1024px;
				margin: 0 auto;
			}

			html,body {
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;

			}


			label.highlighted{
				background: rgba(0,0,0,0.1);
				border-radius: 3px;
			}

			/* The most incredibly lazy way to get points after the year 2008 to appear differently (historic vs simulated)*/
			.best-case-scenario
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory +
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory +
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory + 
			.pointTrajectory +
			.pointTrajectory +
			.pointTrajectory +
			.pointTrajectory +
			.pointTrajectory {
				fill: #C00;
				stroke-width: 0px;
			}

			text {
				cursor: default;
			}

			#chart {
				height: 506px;
			}

			text {
				font-size: 10px;
			}

			.dot, .point {
				stroke: #000;
			}

			.point {
				opacity: 0.5;
			}

			.axis path, .axis line {
				fill: none;
				stroke: #000;
				shape-rendering: crispEdges;
			}

			.label {
				fill: #777;
			}

			.year.label {
				font: 500 196px 'Droid Serif';
				fill: #ddd;
			}

			.x.label, .y.label {
				font-size: 14px;
				text-shadow: 0 0 2px rgba(255, 255, 255, 1), 0 0 2px rgba(255, 255, 255, 1), 0 0 2px rgba(255, 255, 255, 1);
			}

			.country.label  {
				font: 500 96px 'Droid Serif';
				fill: #ddd;
			}

			.year.label.active {
				fill: #aaa;
			}

			.tooltip-box {
				padding: 4px;
				background: #FFF;
				z-index: 1000;
				position: absolute;
				pointer-events:none;
				border-radius: 4px;
				border: 1px solid #CCC;
				font-size: 10px;
			}

			circle.pointTrajectory {
				pointer-events: none;
				stroke: lightgray;
				fill: none;
				opacity: 1;
				stroke-width: 0px;
				pointer-events:none;
			}

			.gDragit {
				pointer-events:none;
			}

			path.lineTrajectory {
				stroke-linejoin: round;
				stroke-width: 3;
				stroke-opacity: .5;
				stroke: black;
				fill: none;
				pointer-events: none;
			}

			#timeline, #scatter{
				/* height: 560px; */
			}


			path.line {
				stroke-linejoin: round;
				stroke-width: 3;
				stroke-opacity: .7;
				stroke: black;
				fill: none;
			}

			span[name="Grey seals"]{ font-weight: 700; color: #0099C6; }
			span[name="Harbour seals"]{ font-weight: 700; color: #DD4477; }
			span[name="Cetaceans"]{ font-weight: 700; color: #66AA00; }
			span[name="Rays"]{ font-weight: 700; color: #9933C6; }
			span[name="Sharks"]{ font-weight: 700; color: #C69933; }
			span[name="Seabirds"]{ font-weight: 700; color: #B82E2E; }
			/* span[name="Poor cod"]{ font-weight: 700; color: #316395; } */
			span[name="Large zooplankton"]{ font-weight: 700; color: #3366CC; }
			span[name="Small zooplankton"]{ font-weight: 700; color: #990099; }
			span[name="Infauna"]{ font-weight: 700; color: #DC3912; }
			span[name="Algae"]{ font-weight: 700; color: #FF9900; }
			span[name="Phytoplankton"]{ font-weight: 700; color: #109618; }
			span[name="Detritus"]{ font-weight: 700; color: black; }

			path.line[name="Grey seals"]{ stroke: #0099C6; }
			path.line[name="Harbour seals"]{ stroke: #DD4477; }
			path.line[name="Cetaceans"]{ stroke: #66AA00; }
			path.line[name="Rays"]{ stroke: #9933C6; }
			path.line[name="Sharks"]{ stroke: #C69933; }
			path.line[name="Seabirds"]{ stroke: #B82E2E; }
			/* path.line[name="Poor cod"]{ stroke: #316395; } */
			path.line[name="Large zooplankton"]{ stroke: #3366CC; }
			path.line[name="Small zooplankton"]{ stroke: #990099; }
			path.line[name="Infauna"]{ stroke: #DC3912; }
			path.line[name="Algae"]{ stroke: #FF9900; }
			path.line[name="Phytoplankton"]{ stroke: #109618; }

			.selected {
				stroke-width: 4;
			}

			button.icon:hover {
				background-color: #DDD;
			}

			.icon {
				border:none;
				background: none;
				width:21px;
				height:21px;
				display:inline-block;
				background-size:cover;
			}

			.icon.icon-play {
				background-image:url('img/ic_play_arrow_black_24px.svg');
				opacity: 0.7;
			}
			.icon.icon-play[disabled] {
				opacity: 0.3;
			}
			.icon.icon-pause {
				background-image:url('img/ic_pause_black_24px.svg');
				opacity: 0.7;
			}
			.icon.icon-reset {
				background-image:url('img/ic_skip_previous_black_24px.svg');
				opacity: 0.7;
			}

			input[type="range"] {
				cursor:pointer;
			}

			td.redlight { 
				color: red;
			}

			td.yellowlight {
				color: darkgoldenrod;
			}

			td.greenlight, tr.greenlight td {
				color: green;
			}
			
			#table_trafficlight td {
				color: #000000;
			}
			
		</style>
	</head>
	<body class="best-case-scenario" style="background: rgba(41,137,202,1);">
		<div style="background: #FFF;
		     width: 1024px; padding: 20px">
			<h1><a href="../baltic-sea.html">&lsaquo; Case Study: Baltic Sea</a></h1>
			<h2>Historical Data and Scenario Model Output</h2>
			<div class="tooltip-box" style="display:none;">
			</div>
			<div class="text-right">
				<h3><a href="scatter-confidence-2.html">To compare scenarios click here</a></h3>
			</div>
			<hr>
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" class="active"><a href="scatter-4.html#timeline" id="timelinetab" aria-controls="timeline" role="tab" data-toggle="tab">Timeline</a></li>
				<li role="presentation"><a href="scatter-4.html#scatter" id="scattertab" aria-controls="scatter" role="tab" data-toggle="tab">Scatterplot (Biomass v Landings)</a></li>
				<li role="presentation"><a href="scatter-4.html#trafficlight" id="trafficlighttab" aria-controls="trafficlight" role="tab" data-toggle="tab">Traffic Light</a></li>
			</ul>
			<div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="timeline">
					<div id="chart_timeline" style="margin:0px"></div>
					<div>
						<div style="width:39px;height:20px;display:table-cell;"></div>
						<div style="width:356px;background:#EEE;height:20px;border-right: 1px dashed;vertical-align: bottom;display:table-cell;padding:5px;text-align:center;font-weight:700;font-size:12px;">Historical data</div>
						
						<div 
							style="width:587px;background: repeating-linear-gradient(
							45deg,
							#F8F8F8,
							#F8F8F8 3px,
							#EEE 3px,
							#EEE 6px
							);height:20px;vertical-align: bottom;display:table-cell;padding:5px;text-align:center;font-weight:700;font-size:12px;">
							Model:<select class="" style="z-index:1;" id="select-model">
								<option value="EwE">EwE</option> 
								<option value="Gadget">Gadget</option> 
								<option value="MSPM">MSPM</option> 
							</select>
							&nbsp;
							&nbsp;
							Simulated data:
							
							<select class="" style="z-index:1;" id="select-scenario">
								<option value="dataOct2017/BAU-HSE-BAU">BAU-HSE-BAU</option> 
								<option value="dataOct2017/BAU-HSE-EnvState_optimization">BAU-HSE-EnvState_optimization</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitAll">BAU-HSE-MaxProfitAll</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitCod">BAU-HSE-MaxProfitCod</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitPel">BAU-HSE-MaxProfitPel</option> 
								<option value="dataOct2017/BAU-HSE-MaxYieldCod">BAU-HSE-MaxYieldCod</option> 
								<option value="dataOct2017/BAU-LSE-BAU">BAU-LSE-BAU</option> 
								<option value="dataOct2017/BAU-LSE-EnvState_optimization">BAU-LSE-EnvState_optimization</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitAll">BAU-LSE-MaxProfitAll</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitCod">BAU-LSE-MaxProfitCod</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitPel">BAU-LSE-MaxProfitPel</option> 
								<option value="dataOct2017/BAU-LSE-MaxYieldCod">BAU-LSE-MaxYieldCod</option> 
								<option value="dataOct2017/BSP-HSE-BAU">BSP-HSE-BAU</option> 
								<option value="dataOct2017/BSP-HSE-EnvState_optimization">BSP-HSE-EnvState_optimization</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitAll">BSP-HSE-MaxProfitAll</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitCod">BSP-HSE-MaxProfitCod</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitPel">BSP-HSE-MaxProfitPel</option> 
								<option value="dataOct2017/BSP-HSE-MaxYieldCod">BSP-HSE-MaxYieldCod</option> 
								<option value="dataOct2017/BSP-LSE-BAU">BSP-LSE-BAU</option> 
								<option value="dataOct2017/BSP-LSE-EnvState_optimization">BSP-LSE-EnvState_optimization</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitAll">BSP-LSE-MaxProfitAll</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitCod">BSP-LSE-MaxProfitCod</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitPel">BSP-LSE-MaxProfitPel</option> 
								<option value="dataOct2017/BSP-LSE-MaxYieldCod">BSP-LSE-MaxYieldCod</option> 
								
							</select>
							
							<!-- <select class="" style="z-index:1;" id="select-scenario">
								<option value="dataOct2017/BAU-HSE-BAU-EwE.json">BAU-HSE-BAU-EwE</option> 
								<option value="dataOct2017/BAU-HSE-BAU-Gadget.json">BAU-HSE-BAU-Gadget</option> 
								<option value="dataOct2017/BAU-HSE-BAU-MSPM.json">BAU-HSE-BAU-MSPM</option> 
								<option value="dataOct2017/BAU-HSE-EnvState_optimization-EwE.json">BAU-HSE-EnvState_optimization-EwE</option> 
								<option value="dataOct2017/BAU-HSE-EnvState_optimization-Gadget.json">BAU-HSE-EnvState_optimization-Gadget</option> 
								<option value="dataOct2017/BAU-HSE-EnvState_optimization-MSPM.json">BAU-HSE-EnvState_optimization-MSPM</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitAll-EwE.json">BAU-HSE-MaxProfitAll-EwE</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitAll-Gadget.json">BAU-HSE-MaxProfitAll-Gadget</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitAll-MSPM.json">BAU-HSE-MaxProfitAll-MSPM</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitCod-EwE.json">BAU-HSE-MaxProfitCod-EwE</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitCod-Gadget.json">BAU-HSE-MaxProfitCod-Gadget</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitCod-MSPM.json">BAU-HSE-MaxProfitCod-MSPM</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitPel-EwE.json">BAU-HSE-MaxProfitPel-EwE</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitPel-Gadget.json">BAU-HSE-MaxProfitPel-Gadget</option> 
								<option value="dataOct2017/BAU-HSE-MaxProfitPel-MSPM.json">BAU-HSE-MaxProfitPel-MSPM</option> 
								<option value="dataOct2017/BAU-HSE-MaxYieldCod-EwE.json">BAU-HSE-MaxYieldCod-EwE</option> 
								<option value="dataOct2017/BAU-HSE-MaxYieldCod-Gadget.json">BAU-HSE-MaxYieldCod-Gadget</option> 
								<option value="dataOct2017/BAU-HSE-MaxYieldCod-MSPM.json">BAU-HSE-MaxYieldCod-MSPM</option> 
								<option value="dataOct2017/BAU-LSE-BAU-EwE.json">BAU-LSE-BAU-EwE</option> 
								<option value="dataOct2017/BAU-LSE-BAU-Gadget.json">BAU-LSE-BAU-Gadget</option> 
								<option value="dataOct2017/BAU-LSE-BAU-MSPM.json">BAU-LSE-BAU-MSPM</option> 
								<option value="dataOct2017/BAU-LSE-EnvState_optimization-EwE.json">BAU-LSE-EnvState_optimization-EwE</option> 
								<option value="dataOct2017/BAU-LSE-EnvState_optimization-Gadget.json">BAU-LSE-EnvState_optimization-Gadget</option> 
								<option value="dataOct2017/BAU-LSE-EnvState_optimization-MSPM.json">BAU-LSE-EnvState_optimization-MSPM</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitAll-EwE.json">BAU-LSE-MaxProfitAll-EwE</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitAll-Gadget.json">BAU-LSE-MaxProfitAll-Gadget</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitAll-MSPM.json">BAU-LSE-MaxProfitAll-MSPM</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitCod-EwE.json">BAU-LSE-MaxProfitCod-EwE</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitCod-Gadget.json">BAU-LSE-MaxProfitCod-Gadget</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitCod-MSPM.json">BAU-LSE-MaxProfitCod-MSPM</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitPel-EwE.json">BAU-LSE-MaxProfitPel-EwE</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitPel-Gadget.json">BAU-LSE-MaxProfitPel-Gadget</option> 
								<option value="dataOct2017/BAU-LSE-MaxProfitPel-MSPM.json">BAU-LSE-MaxProfitPel-MSPM</option> 
								<option value="dataOct2017/BAU-LSE-MaxYieldCod-EwE.json">BAU-LSE-MaxYieldCod-EwE</option> 
								<option value="dataOct2017/BAU-LSE-MaxYieldCod-Gadget.json">BAU-LSE-MaxYieldCod-Gadget</option> 
								<option value="dataOct2017/BAU-LSE-MaxYieldCod-MSPM.json">BAU-LSE-MaxYieldCod-MSPM</option> 
								<option value="dataOct2017/BSP-HSE-BAU-EwE.json">BSP-HSE-BAU-EwE</option> 
								<option value="dataOct2017/BSP-HSE-BAU-Gadget.json">BSP-HSE-BAU-Gadget</option> 
								<option value="dataOct2017/BSP-HSE-BAU-MSPM.json">BSP-HSE-BAU-MSPM</option> 
								<option value="dataOct2017/BSP-HSE-EnvState_optimization-EwE.json">BSP-HSE-EnvState_optimization-EwE</option> 
								<option value="dataOct2017/BSP-HSE-EnvState_optimization-Gadget.json">BSP-HSE-EnvState_optimization-Gadget</option> 
								<option value="dataOct2017/BSP-HSE-EnvState_optimization-MSPM.json">BSP-HSE-EnvState_optimization-MSPM</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitAll-EwE.json">BSP-HSE-MaxProfitAll-EwE</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitAll-Gadget.json">BSP-HSE-MaxProfitAll-Gadget</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitAll-MSPM.json">BSP-HSE-MaxProfitAll-MSPM</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitCod-EwE.json">BSP-HSE-MaxProfitCod-EwE</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitCod-Gadget.json">BSP-HSE-MaxProfitCod-Gadget</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitCod-MSPM.json">BSP-HSE-MaxProfitCod-MSPM</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitPel-EwE.json">BSP-HSE-MaxProfitPel-EwE</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitPel-Gadget.json">BSP-HSE-MaxProfitPel-Gadget</option> 
								<option value="dataOct2017/BSP-HSE-MaxProfitPel-MSPM.json">BSP-HSE-MaxProfitPel-MSPM</option> 
								<option value="dataOct2017/BSP-HSE-MaxYieldCod-EwE.json">BSP-HSE-MaxYieldCod-EwE</option> 
								<option value="dataOct2017/BSP-HSE-MaxYieldCod-Gadget.json">BSP-HSE-MaxYieldCod-Gadget</option> 
								<option value="dataOct2017/BSP-HSE-MaxYieldCod-MSPM.json">BSP-HSE-MaxYieldCod-MSPM</option> 
								<option value="dataOct2017/BSP-LSE-BAU-EwE.json">BSP-LSE-BAU-EwE</option> 
								<option value="dataOct2017/BSP-LSE-BAU-Gadget.json">BSP-LSE-BAU-Gadget</option> 
								<option value="dataOct2017/BSP-LSE-BAU-MSPM.json">BSP-LSE-BAU-MSPM</option> 
								<option value="dataOct2017/BSP-LSE-EnvState_optimization-EwE.json">BSP-LSE-EnvState_optimization-EwE</option> 
								<option value="dataOct2017/BSP-LSE-EnvState_optimization-Gadget.json">BSP-LSE-EnvState_optimization-Gadget</option> 
								<option value="dataOct2017/BSP-LSE-EnvState_optimization-MSPM.json">BSP-LSE-EnvState_optimization-MSPM</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitAll-EwE.json">BSP-LSE-MaxProfitAll-EwE</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitAll-Gadget.json">BSP-LSE-MaxProfitAll-Gadget</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitAll-MSPM.json">BSP-LSE-MaxProfitAll-MSPM</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitCod-EwE.json">BSP-LSE-MaxProfitCod-EwE</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitCod-Gadget.json">BSP-LSE-MaxProfitCod-Gadget</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitCod-MSPM.json">BSP-LSE-MaxProfitCod-MSPM</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitPel-EwE.json">BSP-LSE-MaxProfitPel-EwE</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitPel-Gadget.json">BSP-LSE-MaxProfitPel-Gadget</option> 
								<option value="dataOct2017/BSP-LSE-MaxProfitPel-MSPM.json">BSP-LSE-MaxProfitPel-MSPM</option> 
								<option value="dataOct2017/BSP-LSE-MaxYieldCod-EwE.json">BSP-LSE-MaxYieldCod-EwE</option> 
								<option value="dataOct2017/BSP-LSE-MaxYieldCod-Gadget.json">BSP-LSE-MaxYieldCod-Gadget</option> 
								<option value="dataOct2017/BSP-LSE-MaxYieldCod-MSPM.json">BSP-LSE-MaxYieldCod-MSPM</option>
								
							</select> -->
						</div>
					</div>
					<div>
						<div style="width:39px;height:20px;display:table-cell;"></div>
						<div style="background:#F8F8F8;width:942px;height:20px;display:table-cell;padding:5px;text-align:center;font-weight:700;font-size:12px;">
							y-axis: 
							<select class="" style="z-index:1;" id="select-y-axis">
								<option value="catch">Catch</option>
								<option value="gva">GVA</option>
								<option value="profit">Profit</option>
								<option value="revenue">Revenue</option>
								<!-- <option value="iachangeprofit">IAChangeProfit</option> -->
								<option value="cperb">CperB</option>
								<option value="ssb">SSB</option>
								<option value="length95">Length95</option>
								<option value="propmat">PropMat</option>	
							</select>
						</div>
					</div>
				</div>
				<div role="tabpanel" class="tab-pane" id="scatter">
					<div id="scatterexplanation" style="padding: 10px 0px 10px">
						The graph below shows the historical relationship between Landings (Y axis) and Biomass (X axis). The diameter of the circles 
						are proportional to the value in Euros. Hovering over the circles in the graph will show the absolute values for that species 
						in the selected year. The year can be selected moving the slide under the graph or dragging the circles. The graph's axis
						will automatically adjust to the min/max values of the species selected.
					</div>
					<div id="chart" style="margin:0px"></div>
					<div class="container-fluid">
						<div class="row" style="margin-bottom: 20px;">
							<div class="col-xs-2">
								<button class="icon icon-play" style="margin-right:5px;margin-left:30px;">
								</button>
								<button class="icon icon-pause" style="margin-right:5px;margin-left:30px;display:none;">
								</button>
								<button class="icon icon-reset">
								</button>
								<div class="pull-right">2004</div>
							</div>
							<div class="col-xs-9" style="position: relative;font-weight:700;font-size:12px;">
								<input type="range" name="points" min="2004" max="2032" value="2032" id="slider-time" style="padding:0px;width:98.1%;display:inline-block;position:absolute;z-index:1;"/>
								<div style="position:absolute;">
									<div style="background:#EEE;width: 263px; height: 52px;vertical-align: bottom;display:table-cell;padding:5px;text-align:center;border-right: 1px dashed;">
										Historical data
									</div>
									<div style="background: repeating-linear-gradient(
									     45deg,
									     #F8F8F8,
									     #F8F8F8 3px,
									     #EEE 3px,
									     #EEE 6px
									     );width: 475px; height: 52px;vertical-align: bottom;display:table-cell;padding:5px;text-align:center;">
										Model:<select class="" style="z-index:1;" id="select-model-scatter">
											<option value="EwE">EwE</option> 
											<option value="Gadget">Gadget</option> 
											<option value="MSPM">MSPM</option> 
										</select>
										&nbsp;
										&nbsp;
										Simulated data:
										<select class="" style="z-index:1;" id="select-scenario-scatter">
											<option value="dataOct2017/BAU-HSE-BAU">BAU-HSE-BAU</option> 
											<option value="dataOct2017/BAU-HSE-EnvState_optimization">BAU-HSE-EnvState_optimization</option> 
											<option value="dataOct2017/BAU-HSE-MaxProfitAll">BAU-HSE-MaxProfitAll</option> 
											<option value="dataOct2017/BAU-HSE-MaxProfitCod">BAU-HSE-MaxProfitCod</option> 
											<option value="dataOct2017/BAU-HSE-MaxProfitPel">BAU-HSE-MaxProfitPel</option> 
											<option value="dataOct2017/BAU-HSE-MaxYieldCod">BAU-HSE-MaxYieldCod</option> 
											<option value="dataOct2017/BAU-LSE-BAU">BAU-LSE-BAU</option> 
											<option value="dataOct2017/BAU-LSE-EnvState_optimization">BAU-LSE-EnvState_optimization</option> 
											<option value="dataOct2017/BAU-LSE-MaxProfitAll">BAU-LSE-MaxProfitAll</option> 
											<option value="dataOct2017/BAU-LSE-MaxProfitCod">BAU-LSE-MaxProfitCod</option> 
											<option value="dataOct2017/BAU-LSE-MaxProfitPel">BAU-LSE-MaxProfitPel</option> 
											<option value="dataOct2017/BAU-LSE-MaxYieldCod">BAU-LSE-MaxYieldCod</option> 
											<option value="dataOct2017/BSP-HSE-BAU">BSP-HSE-BAU</option> 
											<option value="dataOct2017/BSP-HSE-EnvState_optimization">BSP-HSE-EnvState_optimization</option> 
											<option value="dataOct2017/BSP-HSE-MaxProfitAll">BSP-HSE-MaxProfitAll</option> 
											<option value="dataOct2017/BSP-HSE-MaxProfitCod">BSP-HSE-MaxProfitCod</option> 
											<option value="dataOct2017/BSP-HSE-MaxProfitPel">BSP-HSE-MaxProfitPel</option> 
											<option value="dataOct2017/BSP-HSE-MaxYieldCod">BSP-HSE-MaxYieldCod</option> 
											<option value="dataOct2017/BSP-LSE-BAU">BSP-LSE-BAU</option> 
											<option value="dataOct2017/BSP-LSE-EnvState_optimization">BSP-LSE-EnvState_optimization</option> 
											<option value="dataOct2017/BSP-LSE-MaxProfitAll">BSP-LSE-MaxProfitAll</option> 
											<option value="dataOct2017/BSP-LSE-MaxProfitCod">BSP-LSE-MaxProfitCod</option> 
											<option value="dataOct2017/BSP-LSE-MaxProfitPel">BSP-LSE-MaxProfitPel</option> 
											<option value="dataOct2017/BSP-LSE-MaxYieldCod">BSP-LSE-MaxYieldCod</option> 

										</select>
									</div>
								</div>
							</div>
							<div class="col-xs-1" style="text-align:left;">2032</div>
						</div>
					</div>
				</div>	
				<div role="tabpanel" class="tab-pane" id="trafficlight">
					<div style="margin:0px">
						<table id="table_trafficlight_wrapper" style="width: 100%">
							<thead>
								<tr>
									<td style="background-color: rgba(255, 255, 255, 1) ; height: 120px">
										<div class="row">
											<div class="col-xs-12">
												<div id="trafficlight-year" style="font-size: 30px; text-align: center">&nbsp;</div><br />
											</div>
										</div>
										<div class="row">
											<div class="col-xs-2">
												<div class="pull-right">1985</div>
											</div>
											<div class="col-xs-9" style="position: relative;font-weight:700;font-size:12px;">
												<input type="range" name="trafficlight_points" min="2004" max="2032" value="2032" id="trafficlight-slider-time" style="padding:0px;width:98.1%;display:inline-block;position:absolute;z-index:1;"/>
												<div style="position:absolute;">
													<div style="background:#EEE;width: 433px; height: 52px;vertical-align: bottom;display:table-cell;padding:5px;text-align:center;border-right: 1px dashed;">
														Historical data
													</div>
													<div style="background: repeating-linear-gradient(
														 45deg,
														 #F8F8F8,
														 #F8F8F8 3px,
														 #EEE 3px,
														 #EEE 6px
														 );width: 305px; height: 52px;vertical-align: bottom;display:table-cell;padding:5px;text-align:center;">
														Simulated data 
														<!-- <select class="" style="z-index:1;" id="select-scenario-scatter">
															<option value="current_path_good.json">Current path scenario</option>
															<option value="mix_MEY_good.json">MixMEY scenario</option>
															<option value="seal_cull_good.json">Seal Cull scenario</option>
															<option value="cod_recovery_good.json">Cod recovery scenario</option>
															<option value="seal_cull_cod_recovery_good.json">Seal cull Cod recovery scenario</option>
															<option value="spatial_F_good.json">Spatial F scenario</option>
															<option value="status_quo_good.json">Status Quo scenario</option>
														</select> -->
													</div>
												</div>
											</div>
											<div class="col-xs-1" style="text-align:left;">2033</div>
										</div>
									</td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>
										<table id="table_trafficlight" style="width: 100%"></table>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>					
			</div>
			<div class="container-fluid" id="trafficlight-controls" style="display: none">
				<div class="row">
					<div class="col-xs-12">
						<br />
						<div id="theTextTrafficLights" class="text-center" style="font-weight:700;font-size:15px;">
							&nbsp;
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-6">
						<h3>&nbsp;
						</h3>
					</div>
				</div>
			</div>
			<div class="container-fluid" id="timeline-and-scatter-controls">
				<div class="row">
					<div class="col-xs-12">
						<br />
						<div id="theText" class="text-center" style="font-weight:normal;font-size:15px;">
							&nbsp;
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xs-6">
						<h3>Fish
							<div class="pull-right">
								<button class="btn btn-xs btn-default select-all" value="Fish">Select All</button>
								<button class="btn btn-xs btn-default deselect-all" value="Fish">Deselect All</button>
							</div>
						</h3>
						<div class="container-fluid">
							<div class="row" id="fishchecks">
								<div class="col-xs-12">
									<h4>Species</h4>
									<div class="checkbox">
										<label><input type="checkbox" autocomplete="off" checked value="herring"/>herring</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="sprat"/>sprat</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="cod"/>cod</label><br/>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xs-6">
						<h3>Fleet
							<div class="pull-right">
								<button class="btn btn-xs btn-default select-all" value="Fleet">Select All</button>
								<button class="btn btn-xs btn-default deselect-all" value="Fleet">Deselect All</button>
							</div>
						</h3>
						<div class="container-fluid">
							<div class="row" id="fishchecks">
								<div class="col-xs-12">
									<h4>Name</h4>
									<div class="checkbox">
										<label><input type="checkbox" autocomplete="off" checked value="bottrawl"/>bottrawl</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="gillnet"/>gillnet</label><br/>
										<label><input type="checkbox" autocomplete="off" checked value="peltrawl"/>peltrawl</label><br/>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<br>
		<!--<p>
		Original creation by <a href="http://www.gapminder.org/world/">Gapminder</a> using <a href="https://github.com/RandomEtc/mind-gapper-js">Tom Carden</a> JavaScript version.<br>
		Recreation by <a href="http://bost.ocks.org/mike/nations/">Mike Bostock</a> with <a href="http://d3js.org/">D3.js</a>.<br>
		Re-Recreation using <a href="http://romsson.github.io/dragit/">dragit.js</a> by <a href="http://romain.vuillemot.net/">Romain Vuillemot</a> (view <a href="https://github.com/romsson/dragit/blob/master/example/nations.html">source</a> on GitHub).-->

		<script>

			$("#trafficlighttab").on("click", function(){
				$("#timeline-and-scatter-controls").hide();
				$("#trafficlight-controls").show();
			});
			$("#timelinetab").on("click", function(){
				$("#trafficlight-controls").hide();
				$("#timeline-and-scatter-controls").show();
			});
			$("#scattertab").on("click", function(){
				$("#trafficlight-controls").hide();
				$("#timeline-and-scatter-controls").show();
			});
			
			// Various accessors that specify the four dimensions of data to visualize.
			function x(d) {
				//return d.profit;
				return d.biomass;
			}
			function y(d) {
				//return d.catch;
				return d.landings;
			}
			function radius(d) {
				if (d.value < 0) { 
					return 0;
				} else {
					return d.value;
				}
			}
			function color(d) {
				return d.region;
			}
			function key(d) {
				return d.name;
			}
			var selected_y_axis = "catch";
			var speed = 10;
			var playing = false;
			var externallink;
			var cached = false;
			var cached_interpolatedData = {};

			function randomize_dataset() {
				if (externallink) {
					for (var i = 0; i < externallink.length; i++) {
						for (var u = 0; u < externallink[i].biomass.length; u++) {
							externallink[i].biomass[u][1] = externallink[i].biomass[u][1] * (Math.random() * 0.2 + 0.9);
							externallink[i].landings[u][1] = externallink[i].landings[u][1] * (Math.random() * 0.2 + 0.9);
							externallink[i].value[u][1] = externallink[i].value[u][1] * (Math.random() * 0.2 + 0.9);
						}
					}
				}
			}

			var whoah;
		// Chart dimensions.
			var margin = {top: 19.5, right: 19.5, bottom: 19.5, left: 69.5},
			width = 930 - margin.right,
				height = 500 - margin.top - margin.bottom;

		// Various scales. These domains make assumptions of data, naturally.
			var xScale = d3.scale.linear().domain([0.00000, 1700000]).range([0, width]),
				yScale = d3.scale.linear().domain([0.00000, 350000]).range([height, 0]),
				radiusScale = d3.scale.sqrt().domain([0, 100]).range([1, 10]),
				colorScale = d3.scale.category20();

		// The x & y axes.
			var xAxis = d3.svg.axis().orient("bottom").scale(xScale),
				yAxis = d3.svg.axis().scale(yScale).orient("left");

		// Create the SVG container and set the origin.
			var svg = d3.select("#chart").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
				.attr("class", "gRoot")

		// Add the x-axis.
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);

		// Add the y-axis.
			svg.append("g")
				.attr("class", "y axis")
				.call(yAxis);

		// Add an x-axis label.
			var svg_x_axis_label = svg.append("text")
				.attr("class", "x label")
				.attr("text-anchor", "end")
				.attr("x", width)
				.attr("y", height - 6)
				.text("Biomass (1000t"); //tons / km
		
			svg_x_axis_label.append("tspan")
				.attr("dy", -5)
				.text(""); //2
			svg_x_axis_label.append("tspan")
				.attr("dy", 5)
				.text(")");

		// Add a message to the top right hand corner of the graph illustrating
		// what the size of the circles represents
			svg.append("text")
				.attr("class", "x label")
				.attr("text-anchor", "end")
				.attr("x", width)
				.attr("y", 0)
				.text("Radii of circles represent value (€m) of catch");

		// Add a y-axis label.
			var svg_y_axis_label = svg.append("text")
				.attr("class", "y label")
				.attr("text-anchor", "end")
				.attr("y", 6)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text("Catch (tons"); //tons / km

			svg_y_axis_label.append("tspan")
				.attr("dy", -5)
				.text(""); //2
			svg_y_axis_label.append("tspan")
				.attr("dy", 5)
				.text(")");

		// Add the year label; the value is set on transition.
			var label = svg.append("text")
				.attr("class", "year label")
				.attr("text-anchor", "end")
				.attr("y", height - 24)
				.attr("x", width)
				.text(2032);

		// Add the country label; the value is set on transition.
			var countrylabel = svg.append("text")
				.attr("class", "country label")
				.attr("text-anchor", "start")
				.attr("y", 80)
				.attr("x", 20)
				.text(" ");


		// timeline svg
		// Various scales. These domains make assumptions of data, naturally.
			var xScale_t = d3.scale.linear().domain([2004, 2032]).range([0, width]),
				yScale_t = d3.scale.linear().domain([0.00000, 1600000]).range([height, 0]),
				radiusScale_t = d3.scale.sqrt().domain([0, 100]).range([1, 10]),
				colorScale_t = d3.scale.category20();

		// The x & y axes.
			var xAxis_t = d3.svg.axis().orient("bottom").scale(xScale_t).tickFormat(d3.format("d")),
				yAxis_t = d3.svg.axis().scale(yScale_t).orient("left");

			var svg_t = d3.select("#chart_timeline").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
				.attr("class", "gRoot");

		// Add the x-axis.
			svg_t.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis_t);

		// Add the y-axis.
			svg_t.append("g")
				.attr("class", "y axis")
				.call(yAxis_t);

		// Add an x-axis label.
			var svg_t_x_axis_label = svg.append("text")
				.attr("class", "x label")
				.attr("text-anchor", "end")
				.attr("x", width)
				.attr("y", height - 6)
				.text("Biomass (1000t"); //tons / km

			svg_t_x_axis_label.append("tspan")
				.attr("dy", -5)
				.text(""); //2
			svg_t_x_axis_label.append("tspan")
				.attr("dy", 5)
				.text(")");

		// Add a y-axis label.
			var svg_t_y_axis_label = svg.append("text")
				.attr("class", "y label")
				.attr("text-anchor", "end")
				.attr("y", 6)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text("Catch (tons"); //tons / km

			svg_t_y_axis_label.append("tspan")
				.attr("dy", -5)
				.text(""); //2
			svg_t_y_axis_label.append("tspan")
				.attr("dy", 5)
				.text(")");

			svg_t.append("svg:line")
				.attr("class", 'd3-dp-line')
				.attr("x1", xScale_t(2014))
				.attr("y1", yScale_t(0))
				.attr("x2", xScale_t(2014))
				.attr("y2", yScale_t(120*70000))
				.style("stroke-dasharray", ("3, 3"))
				.style("stroke-opacity", 0.9)
				.style("stroke", "black");

			//for (var i = 0; i < redundant_graphs.length; i++) {


			//}
			//console.log(the_correct_graph_scale)



			var first_time = true;

		// Load the data.
			//$('#fishchecks input:checkbox').prop('checked', false);
			//$('#fishchecks input:checkbox').trigger('click');
			
			d3.json("dataOct2017/BAU-HSE-BAU-EwE.json", function (nations) {

				// We will no load in three other managent scenarious
				/*d3.json("fish-worst-case.json", function(nations) {
		 
				 });*/
		
				externallink = nations;

				//var to_add_to_v = [""];
				//var to_add_to_iv = ["Large zooplankton", "Small zooplankton", "Infauna", "Algae", "Phytoplankton"]
				//var to_add_to_d = ["Detritus"]
				var to_ignore = ["Poor cod"]
				var line_v = [];
				var line_iv = [];
				var line_d = [];

				for (var i = 0; i < nations.length; i++) {
					var svg_ti;
					var xScale_ti;
					var yScale_ti;
					if (to_ignore.indexOf(nations[i].name) >= 0) {
						//skip
					} else {
						if (typeof(nations[i].catch) !== 'undefined') {
							// Add to the main timeline
							var line = d3.svg.line()
								.x(function (d) {
									return xScale_t(d[0]);
								})
								.y(function (d) {
									return yScale_t(d[1]);
								});
							var d_path = svg_t.insert("path", ":first-child")
								.datum(nations[i].catch)
								.attr("class", "line line-graph")
								.attr("name", nations[i].name)
								.style("stroke", function (d) {
									return colorScale_t(color(nations[i]));
								})
								.attr("d", line);
						
							for (var u = 0; i, u < nations[i].catch.length; u++) {
								var dot = svg_t.append("circle")
									.datum( {i: i, u: u } )
									.attr("class", "point")
									.attr("name", nations[i].name + "-" + nations[i].catch[u][0])
									.attr("cx", function (d) {
										return xScale_t(nations[i].catch[u][0]);
									})
									.attr("cy", function (d) {
										return yScale_t(nations[i].catch[u][1]);
									})
									.attr("r", 2)
									.on("mouseover", function (d) {
										var datum = d3.select(this).datum();
										$(".tooltip-box").css("left", d3.event.pageX).css("top", d3.event.pageY + 20).show();
										
										var dataSetInfo = ""; //"<br>Dataset: " + parseFloat((nations[datum.i].dataset[datum.u][1]).toPrecision(3)) + " " + " ";
										
										if ($("#select-y-axis").val() == 'catch') {
											dataSetInfo = "<br>Catch: " + parseFloat((nations[datum.i].catch[datum.u][1]).toFixed(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 't';
										} else if ($("#select-y-axis").val() == 'gva') {
											dataSetInfo = "<br>GVA: " + parseFloat((nations[datum.i].gva[datum.u][1]).toPrecision(3)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										} else if ($("#select-y-axis").val() == 'profit') {
											dataSetInfo = "<br>Profit " + parseFloat((nations[datum.i].profit[datum.u][1]).toPrecision(3)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										} else if ($("#select-y-axis").val() == 'revenue') {
											dataSetInfo = "<br>Revenue: " + parseFloat((nations[datum.i].revenue[datum.u][1]).toPrecision(3)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										} else if ($("#select-y-axis").val() == 'cperb') {
											dataSetInfo = "<br>CperB: " + parseFloat((nations[datum.i].cperb[datum.u][1]).toPrecision(3)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										} else if ($("#select-y-axis").val() == 'ssb') {
											dataSetInfo = "<br>SSB: " + parseFloat((nations[datum.i].ssb[datum.u][1]).toPrecision(3)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										} else if ($("#select-y-axis").val() == 'length95') {
											dataSetInfo = "<br>Length95: " + parseFloat((nations[datum.i].length95[datum.u][1]).toPrecision(3)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										} else if ($("#select-y-axis").val() == 'propmat') {
											dataSetInfo = "<br>PropMat: " + parseFloat((nations[datum.i].propmat[datum.u][1]).toPrecision(3)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ";
										} 
										
									   
										$(".tooltip-box").html( 
											nations[datum.i].name +
											"<br>Year: " + parseFloat((nations[datum.i].catch[datum.u][0])) + " " +
											dataSetInfo 
										);	
										

										//	$(".tooltip-box").html( 
										//		nations[datum.i].name +
										//		"" +
										//		"<br>Catch " + parseFloat((nations[datum.i].catch[datum.u][1]).toFixed(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 't' +
										//		""
										//		/* "<br>Year: " + parseFloat((nations[datum.i].biomass[datum.u][0])) + " " +
										//		"<br>Biomass: " + parseFloat((nations[datum.i].biomass[datum.u][1]).toFixed(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 't' +
										//		"<br>Catch " + parseFloat((nations[datum.i].landings[datum.u][1]).toFixed(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 't' +
										//		"<br>Value: €" + parseFloat((nations[datum.i].value[datum.u][1]).toPrecision(3) * 1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " " */
										//		); //" tons/"


									})
									.on("mouseout", function (d) {
										$(".tooltip-box").hide();
									});
							}
						}
						continue;
					}
					var line = d3.svg.line()
						.x(function (d) {
							return xScale_ti(d[0]);
						})
						.y(function (d) {
							return yScale_ti(d[1]);
						})

					var d_path = svg_ti.insert("path", ":first-child")
						.datum(nations[i].ssb) //biomass
						.attr("class", "line line-graph")
						.attr("name", nations[i].name)
						.attr("transform", "translate(-10," + 0 + ")")
						.attr("d", line);
				}


				/*var line = d3.svg.line()
				 .x(function(d) { return xScale_d(d[0]); })
				 .y(function(d) { return yScale_d(d[1]); });
		 
				 //add line data to graph
				 var d_path = svg_d.append("path")
				 .datum(nations[40].biomass)
				 .attr("class", "detritus-line")
				 .attr("transform", "translate(-10," + 0 + ")")
				 .attr("d", line);*/

				// A bisector since many nation's data is sparsely-defined.
				var bisect = d3.bisector(function (d) {
					return d[0];
				});

				//console.log(d3.selectAll(".dot").data().property.data);

				// Add a dot per nation. Initialize the data at 1800, and set the colors.
				var dot = svg.append("g")
					.attr("class", "dots")
					.selectAll(".dot")
					.data(interpolateData(2004))
					.enter().append("circle")
					.attr("class", "dot")
					.style("fill", function (d) {
						console.log(d);
						return colorScale_t(color(d)); //changed from colorScale
					})
					.call(position)
					.on("mousedown", function (d, i) {

					})
					.on("mouseup", function (d, i) {
						dot.classed("selected", false);
						d3.select(this).classed("selected", !d3.select(this).classed("selected"));
						dragit.trajectory.display(d, i, "selected");

						//TODO: test if has been dragged
						// Look at the state machine history and find a drag event in it?

					})
					.on("mouseenter", function (d, i) {
						clear_demo();
						if (dragit.statemachine.current_state == "idle") {
							dragit.trajectory.display(d, i)
							dragit.utils.animateTrajectory(dragit.trajectory.display(d, i), dragit.time.current, 3000)
							countrylabel.text(d.name);
							dot.style("opacity", .4)
							d3.select(this).style("opacity", 1)
							d3.selectAll(".selected").style("opacity", 1)
							//if(){
							//}
						}
						$("input[type='checkbox'][value='" + d.name + "']").parent().addClass("highlighted");
					})
					.on("mousemove", function (d, i, c) {
						$(".tooltip-box").css("left", d3.event.pageX).css("top", d3.event.pageY + 20).show();
						$(".tooltip-box").html(
							" "
							// "Value: €" + parseFloat((radius(d) * 1000).toPrecision(3))).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") +
							// "<br>Biomass: " + parseFloat((x(d)).toFixed(3)) + " " +
							// "<br>Landings: " + parseFloat((y(d)).toFixed(3)) + " "
							)
					})
					.on("mouseleave", function (d, i) {
						$(".tooltip-box").hide();
						if (dragit.statemachine.current_state == "idle") {
							countrylabel.text("");
							dot.style("opacity", 1);
						}
						$("input[type='checkbox'][value='" + d.name + "']").parent().removeClass("highlighted");
						//if($(".dot.selected").length>0){
						//while($(".gDragit.selected").length>1){
						//$(".gDragit.selected:last-of-type").remove();
						//}
						//} else {
						d3.selectAll(".gDragit.selected").remove();
						dragit.trajectory.remove(d, i);
						//}
					})
					.call(dragit.object.activate)
				// Add a title.
				dot.attr("name", function (d) {
					return d.name
				})
				//.append("title")
				//.text(function(d) { return d; });
				
				// Start a transition that interpolates the data based on year.
				svg.transition()
					.duration(30000)
					.ease("linear")


				// Positions the dots based on data.
				function position(dot) {
					dot.transition().duration(speed).ease("linear")
						.attr("cx", function (d) {
							
							//console.log(x(d));
							console.log(d);
							return xScale(x(d));
						})
						.attr("cy", function (d) {
							return yScale(y(d));
						})
						.attr("r", function (d) {
							return radiusScale(radius(d));
						});

					dot.select("title").text(function (d) {
						return ("€" + parseFloat((radius(d) * 1000).toPrecision(3))).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
					})
				}

				// Defines a sort order so that the smallest dots are drawn on top.
				function order(a, b) {
					return radius(b) - radius(a);
				}

				// Updates the display to show the specified year.
				function displayYear(year) {
					dot.data(interpolateData(year), key).call(position).sort(order);
					label.text(Math.floor(year));
					//for (var i = 0; i < redundant_graphs_indicator.length; i++) {
						//redundant_graphs_indicator[i].transition().duration(speed).ease("linear").attr("x1", redundant_graphs_xScale[i](year)).attr("x2", redundant_graphs_xScale[i](year));
					//}
				}

				// Interpolates the dataset for the given (fractional) year.
				function interpolateData(year) {
					//console.log(year)
					if (cached) {
						return cached_interpolatedData[year];
					} else {
						for (var i = 2004; i <= 2032; i++) {
							cached_interpolatedData[i] = nations.map(function (d) {
								//console.log("d:");
								//console.log(d);
								//var test = interpolateValues(d.value, i);
								//if (test == 100) console.log(d.name);
							
								return {
									name: d.name,
									region: d.region,
									biomass: interpolateValues(d.ssb, i),
									landings: interpolateValues(d.catch, i),
									value: interpolateValues(d.revenue, i)
								};
							
							});
						}
						cached = true;
						return cached_interpolatedData[year];
					}
				}

				// Finds (and possibly interpolates) the value for the specified year.
				function interpolateValues(values, year) {
					
					var i = bisect.left(values, year, 0, values.length - 1),
						a = values[i];
					if (typeof(a) == 'undefined') {
						//console.log("interpolateValues could find no values for the year:" + year);
						return 0;
					}
					if (i > 0) {
						var b = values[i - 1],
							t = (year - a[0]) / (b[0] - a[0]);
						return a[1] * (1 - t) + b[1] * t;
					}
					return a[1];
				}



				init();

				function update(v, duration) {
					dragit.time.current = v || dragit.time.current;
					displayYear(2004 + dragit.time.current)
					d3.select("#slider-time").property("value", 2004 + dragit.time.current);
				}

				function init() {

					dragit.init("#chart .gRoot");

					dragit.time = {min: 2004, max: 2032, step: 1, current: 2032}
					dragit.data = d3.range(nations.length).map(function () {
						return Array();
					})

					nations.map(function (d) {
						if (d.name == "Grey seals") {
							$(".dot[name='" + d.name + "']").each(function () {
								$(this).attr("class", $(this).attr("class") + " hidden");
							});
						}
					});

					for (var yy = 2004; yy < 2033; yy++) {

						interpolateData(yy).filter(function (d, i) {
							dragit.data[i][yy - dragit.time.min] = [xScale(x(d)), yScale(y(d))];

						})
					}

					dragit.evt.register("update", update);

					d3.select("#slider-time").property("value", dragit.time.current);

					d3.select("#slider-time")
						.on("input", function () {
							displayYear(parseInt(this.value), 500);
							clear_demo();
						})
						.on("change", function () {
							displayYear(parseInt(this.value), 500);
							clear_demo();
						})
						.on("mousedown", function () {
							speed = 10;
							$(".icon-pause").click();
						})

					d3.selectAll(".dot")
						.on("mousedown", function () {
							speed = 10;
							$(".icon-pause").click();
						})
						
					d3.select("#select-scenario")
						.on("change", function () {
							//console.log("there was an input!")
							var md = $("#select-model").val();
							var flname = $(this).val() + '-' + md + '.json';
					
							d3.json(flname, function (new_nations) {
								cached = false;
								nations = new_nations;
								rescaleGraph();
								//rescaleBiomassGraphs();
								rescaleTimelineGraph();
							});
							$("#select-scenario-scatter").val($("#select-scenario").val());
							updateInfo($(this).val());
						});

					d3.select("#select-scenario-scatter")
						.on("change", function () {
							//console.log("there was an input!")
							var md = $("#select-model").val();
							var flname = $(this).val() + '-' + md + '.json';
							d3.json(flname, function (new_nations) {
								cached = false;
								nations = new_nations;
								rescaleGraph();
								//rescaleBiomassGraphs();
								rescaleTimelineGraph();
							});
							$("#select-scenario").val($("#select-scenario-scatter").val());
							updateInfo($(this).val());
						});
						
		
					$("#select-y-axis option[value=length95]").prop('disabled',true);

					d3.select("#select-model")
						.on("change", function () {
							//console.log("there was an input!")
							var md = $("#select-model").val();
							var flname = $("#select-scenario").val() + '-' + md + '.json';
							
							d3.json(flname, function (new_nations) {
								cached = false;
								nations = new_nations;
								rescaleGraph();
								//rescaleBiomassGraphs();
								rescaleTimelineGraph();
							});
							$("#select-model-scatter").val($("#select-model").val());
							updateInfo($("#select-scenario").val());
							
							if (['Gadget'].indexOf($(this).val()) != -1) {
								$("#select-y-axis option[value=length95]").prop('disabled',false);
							} else {
								$("#select-y-axis option[value=length95]").prop('disabled',true);
							}
							
						});
						
						
					d3.select("#select-model-scatter")
						.on("change", function () {
							//console.log("there was an input!")
							var md = $("#select-model").val();
							var flname = $("#select-scenario").val() + '-' + md + '.json';
					
							d3.json(flname, function (new_nations) {
								cached = false;
								nations = new_nations;
								rescaleGraph();
								//rescaleBiomassGraphs();
								rescaleTimelineGraph();
							});
							$("#select-model").val($("#select-model-scatter").val());
							updateInfo($("#select-scenario").val());
						});
						

					d3.select("#select-y-axis")
						.on("change", function () {
							selected_y_axis = $(this).val();
							rescaleTimelineGraph();
						});


					var end_effect = function () {
						countrylabel.text("");
						dot.style("opacity", 1)
					}

					dragit.evt.register("dragend", end_effect);

					var show_nation = function (nation) {
						$(".dot[name='" + nation + "']").each(function () {
							$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
						});
						$(".line[name='" + nation + "']").each(function () {
							$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
						});
						$(".point[name^='" + nation + "']").each(function () {
							$(this).attr("class", $(this).attr("class").replace(" hidden", ""));
						});
					}

					var hide_nation = function (nation) {
						$(".dot[name='" + nation + "']").each(function () {
							if ($(this).attr("class").indexOf("hidden") == -1) {
								$(this).attr("class", $(this).attr("class") + " hidden");
								//dot.style("color", '#f00');
							}
						});
						$(".line[name='" + nation + "']").each(function () {
							if ($(this).attr("class").indexOf("hidden") == -1)
								$(this).attr("class", $(this).attr("class") + " hidden");
						});
						$(".point[name^='" + nation + "']").each(function () {
							if ($(this).attr("class").indexOf("hidden") == -1)
								$(this).attr("class", $(this).attr("class") + " hidden");
						});
					}

					var rescaleBiomassGraphs = function () {

						var graphs = [svg_v, svg_iv, svg_d];
						var graphs_xscale = [xScale_v, xScale_iv, xScale_d];
						var graphs_yscale = [yScale_v, yScale_iv, yScale_d];

						for (var g = 0; g < graphs.length; g++) {
							var line = d3.svg.line()
								.x(function (d) {
									return graphs_xscale[g](d[0]);
								})
								.y(function (d) {
									return graphs_yscale[g](d[1]);
								});

							var paths = graphs[g].selectAll("path.line").datum(function () {

								var name_to_lookup = d3.select(this).attr("name");
								for (var i = 0; i < nations.length; i++) {
									if (nations[i].name == name_to_lookup) {
										return nations[i].biomass;
									}
								}
							}).transition().duration(speed).attr('d', line);
						}
					}

					var rescaleTimelineGraph = function () {
						// calculate the maximum 
						var max_y = 0.001;
						var min_y = 0.000;
						for (var i = 0; i < nations.length; i++) {
							if (typeof($("#chart_timeline .line[name='" + nations[i].name + "']").attr("class")) == 'undefined') continue;
							
							if ($("#chart_timeline .line[name='" + nations[i].name + "']").attr("class").indexOf(" hidden") >= 0) {
								console.log("hidden line ignored!")
							} else if ($("input[type='checkbox'][value='" + nations[i].name + "']").prop('checked') == false) {
								console.log("unchecked species ignored! *");
							} else {
								//console.log("test" + nations[i].name);
								//console.log("test" + selected_y_axis);
								for (var u = 0; u < nations[i][selected_y_axis].length; u++) {	
									var yav = parseFloat(nations[i][selected_y_axis][u][1]);
								//	if ($(".point[name='" + nations[i].name + "-" + nations[i][selected_y_axis][u][0] + "']").attr("class").indexOf(" hidden") >= 0) { //$(".point[name='" + nations[i].name + "-" + nations[i][selected_y_axis][u][0] + "']").attr("class").indexOf(" hidden") >= 0) {
										
								//	} else {
										if (yav > max_y) {
											max_y = yav;
										}
										
										if (yav < min_y) {
											min_y = yav;
										}
								//	}
								
									//console.log('max_y: ' + max_y + ' min_y: ' + min_y);
								}
								
							}
						}
						
						//console.log('max_y: ' + max_y + ' min_y: ' + min_y);
						//max_y = 100 + Math.random()*50;
						//console.log("max_y:" + max_y);
						// change the scale
						yScale_t = d3.scale.linear().domain([min_y, max_y]).range([height, 0]);
						yAxis_t = d3.svg.axis().scale(yScale_t).orient("left");
						svg_t.selectAll("g.y.axis").transition().duration(speed).ease("linear").call(yAxis_t);
						// arrange the dots
						for (var i = 0; i < nations.length; i++) {
							for (var u = 0; u < nations[i][selected_y_axis].length; u++) {
								svg_t.selectAll(".point[name='" + nations[i].name + "-" + nations[i][selected_y_axis][u][0] + "']")
									.transition().duration(1000).ease("linear")
									.attr("cy", (yScale_t(nations[i][selected_y_axis][u][1])))
									.style("opacity", function () {
										//console.log("t:" + d[1][1]);
										if (nations[i][selected_y_axis][u][1] == 0.0) return 0; else return 1;
									});
							}
						}
						// arrange the lines
						/*
						for (var i = 0; i < nations.length; i++) {
							var line = d3.svg.line()
								.y(function (d) {
									return yScale_t(d[1]);
								});
							var d_path = svg_t.selectAll(".line[name='" + nations[i].name + "']")
								.datum(nations[i][selected_y_axis])
								.transition().duration(10000).ease("linear")
								.attr("d", line);
							console.log("lines...");
						} */
		
						for (var i = 0; i < nations.length; i++) {
							var line = d3.svg.line()
								.x(function (d) {
									return xScale_t(d[0]);
								})
								.y(function (d) {
									return yScale_t(d[1]);
								});
							var d_path = svg_t.selectAll(".line[name='" + nations[i].name + "']")
								.datum(nations[i][selected_y_axis])
								.transition().duration(1000).ease("linear")
								.attr("d", line)
								.style("opacity", function (d) {
									//console.log("t:" + d[1][1]);
									if (d[1][1] == 0.0) return 0; else return 1;
								});
						}	
		
		
					}

					var rescaleGraph = function () {
						speed = 1000;
						var max_x = 0.02;
						var max_y = 0.001;
						var max_r = 0.001;

						for (var yy = 2004; yy <= 2032; yy++) {
							interpolateData(yy).filter(function (d, i) {
								//console.log($(".dot[name='"+d.name+"']").attr("class"));
								if ($(".dot[name='" + d.name + "']").attr("class").indexOf(" hidden") >= 0) {
									//console.log("ignored!")
								} else {
									if (x(d) > max_x)
										max_x = x(d);
									if (y(d) > max_y)
										max_y = y(d);
									if (radius(d) > max_r)
										max_r = radius(d);
								}
								//dragit.data[i][yy-dragit.time.min] = [xScale(x(d)), yScale(y(d))];
							});
						}
						xScale = d3.scale.linear().domain([0.0000, max_x]).range([0, width]);
						yScale = d3.scale.linear().domain([0.0000, max_y]).range([height, 0]);
						radiusScale = d3.scale.sqrt().domain([0, max_r]).range([3, 30]);
						xAxis = d3.svg.axis().orient("bottom").scale(xScale);
						yAxis = d3.svg.axis().scale(yScale).orient("left")
						svg.selectAll("g.x.axis").transition().duration(speed).ease("linear").call(xAxis);
						svg.selectAll("g.y.axis").transition().duration(speed).ease("linear").call(yAxis);
						for (var yy = 2004; yy <= 2032; yy++) {

							interpolateData(yy).filter(function (d, i) {
								dragit.data[i][yy - dragit.time.min] = [xScale(x(d)), yScale(y(d))];

							})
						}
						d3.selectAll(".gDragit.selected").remove();
						displayYear(parseInt(d3.select("#slider-time").property("value")), 0);
						setTimeout(function () {
							speed = 10;
						}, 1000);
					}

					whoah = rescaleGraph;
					//whoah2 = rescaleBiomassGraphs;

					d3.selectAll("button.deselect-all,button.select-all").on("click", function () {
						var select = [];
						if ($(this).val() == "Fish") {
							select = [
								'herring',
								'sprat',
								'cod'];
						} else if ($(this).val() == "Fleet") {
							select = [
								'bottrawl',
								'gillnet',
								'peltrawl'];
						}
						for (var i = 0; i < select.length; i++) {
							if ($(this).hasClass("deselect-all")) {
								$("input[type='checkbox'][value='" + select[i] + "']").prop('checked', false);
								hide_nation(select[i]);
							} else {
								$("input[type='checkbox'][value='" + select[i] + "']").prop('checked', true);
								show_nation(select[i]);
							}
						}
						rescaleGraph();
						rescaleTimelineGraph();
					});

					d3.selectAll("input[type='checkbox']").on("click", function () {
						if ($(this).is(':checked')) {
							show_nation($(this).val());
						} else {
							hide_nation($(this).val());
						}
						rescaleGraph();
						rescaleTimelineGraph();
					});

					$("input[type='checkbox']").parent()
						.on("mouseenter", function () {
							var m = document.createEvent('Event');
							m.initEvent('mouseenter', true, true);
							$(".dot[name='" + $(this).find("input[type='checkbox']").val() + "']")[0].dispatchEvent(m);
						})
						.on("mouseleave", function () {
							var m = document.createEvent('Event');
							m.initEvent('mouseleave', true, true);
							$(".dot[name='" + $(this).find("input[type='checkbox']").val() + "']")[0].dispatchEvent(m);
						});
										
					function clearFish() {
						select = [
								'bottrawl',
								'gillnet',
								'herring',
								'sprat',
								'cod',
								'peltrawl'
								];

						for (var i = 0; i < select.length; i++) {
							$("input[type='checkbox'][value='" + select[i] + "']").prop('checked', false);
							hide_nation(select[i]);
							
							$("input[type='checkbox'][value='" + select[i] + "']").parent().css('color', colorScale_t(select[i]));
							//alert(colorScale_t(select[i]));
						}
						//rescaleGraph();
						//rescaleTimelineGraph();		
					}						
						
					rescaleGraph();
					//rescaleBiomassGraphs();
					rescaleTimelineGraph();
					clearFish();
					updateInfo($('#select-scenario :selected').val());
				}

				function updateInfo(selectval) {
					var theText = "";
					
					var firstScen = "";
					var secondScen = "";
					var thirdScen = "";
					
					var tmpmodel = "Model: <span style='font-weight: bold'>" + $('#select-model').val() + "</span>";
					var tmpselection = selectval.split("/").pop();
					var tmpscenarios = tmpselection.split("-");
					
					
					switch (tmpscenarios[0]) {
						case 'BAU':
							firstScen = "Env scenario: <span style='font-weight: bold'>BAU</span>";
							break;
						case 'BSP':
							firstScen = "Env scenario: <span style='font-weight: bold'>BSP</span>";
							break;
						default: 
					}
					
					switch (tmpscenarios[1]) {
						case 'HSE':
							secondScen = "Seal scenario: <span style='font-weight: bold'>HSE</span>";
							break;
						case 'LSE':
							secondScen = "Seal scenario: <span style='font-weight: bold'>LSE</span>";
							break;
						default: 
					}
					
					switch (tmpscenarios[2]) {
						case 'BAU':
							thirdScen = "Mgmt scenario: <span style='font-weight: bold'>BAU</span>";
							break;
						case 'EnvState_optimization':
							thirdScen = "Mgmt scenario: <span style='font-weight: bold'>EnvState optimization</span>";
							break;
						case 'MaxProfitAll':
							thirdScen = "Mgmt scenario: <span style='font-weight: bold'>MaxProfitAll</span>";
							break;
						case 'MaxProfitCod':
							thirdScen = "Mgmt scenario: <span style='font-weight: bold'>MaxProfitCod</span>";
							break;
						case 'MaxProfitPel':
							thirdScen = "Mgmt scenario: <span style='font-weight: bold'>MaxProfitPel</span>";
							break;
						case 'MaxYieldCod':
							thirdScen = "Mgmt scenario: <span style='font-weight: bold'>MaxYieldCod</span>";
							break;
						default: 
					}
					
					theText = tmpmodel + ', ' + firstScen + ', ' + secondScen + ', ' + thirdScen;
					
					
					$('#theText').html(theText);
					
				}

				function clear_demo() {
					if (first_time) {
						svg.transition().duration(0);
						first_time = false;
						window.clearInterval(demo_interval);
						countrylabel.text("");
						dragit.trajectory.removeAll();
						d3.selectAll(".dot").style("opacity", 1)
					}
				}

				function play_demo() {

					var ex_nations = ['bottrawl', 'gillnet', 'herring', 'sprat']
					var index_random_nation = null;
					var random_index = Math.floor(Math.random() * ex_nations.length);
					var random_nation = nations.filter(function (d, i) {
						if (d.name == ex_nations[random_index]) {
							index_random_nation = i;
							return true;
						}
					})[0];

					var random_nation = nations[index_random_nation];
					

					
					dragit.trajectory.removeAll();
					console.log('random_nation:');
					console.log(random_nation);	
					dragit.trajectory.display(random_nation, index_random_nation);			
					console.log(':random_nation');
					countrylabel.text(random_nation.name);
					

					dragit.utils.animateTrajectory(dragit.lineTrajectory, dragit.time.min, 3000)

					d3.selectAll(".dot").style("opacity", .4)

					d3.selectAll(".dot").filter(function (d) {
						return d.name == random_nation.name;
					}).style("opacity", 1)
					
					
				}

				var demo_interval = null;

				setTimeout(function () {
					if (first_time) {
						play_demo()
						demo_interval = setInterval(play_demo, 4000)
					}
				}, 1000);

				displayYear(parseInt(d3.select("#slider-time").property("value")), 0);

				var nextframe = function () {
					if (!playing)
						return;
					speed = 1000;
					var m = document.createEvent('Event');
					m.initEvent('input', true, true);
					$("#slider-time").val(parseInt($("#slider-time").val()) + 1)[0].dispatchEvent(m);
					if (parseInt($("#slider-time").val()) >= 2032) {
						$(".icon-pause").click();
						return;
					}
					setTimeout(nextframe, 1000);
				}

				$(".icon-reset").click(function () {
					speed = 10;
					var m = document.createEvent('Event');
					m.initEvent('input', true, true);
					$("#slider-time").val(1)[0].dispatchEvent(m);
					$(".icon-pause").click();
					playing = false;
				});

				$(".icon-play").click(function () {
					if (parseInt($("#slider-time").val()) >= 2032) {
						$(".icon-reset").click();
						setTimeout(function () {
							$(".icon-play").click();
						}, 1000);
						return;
					}
					$(".icon-play").hide();
					$(".icon-pause").show();
					playing = true;
					nextframe();
				});

				$(".icon-pause").click(function () {
					$(".icon-pause").hide();
					$(".icon-play").show();
					speed = 10;
					playing = false;
				});


			});


		</script>
		
		<script>
			var traffic_light_thresholds = [
				{ species: "herring", red_yellow: 560.071899, yellow_green: 579.4204305}, 
				{ species: "sprat", red_yellow: 215.8862556, yellow_green: 298.7766776}, 
				{ species: "cod", red_yellow: 71.85248507, yellow_green: 85.66466696}, 
				
				/*
				
				{ species: "bottrawl", red_yellow: 1728.150295, yellow_green: 2035.599272}, 
				{ species: "gillnet", red_yellow: 14000, yellow_green: 22000}, 
				{ species: "peltrawl", red_yellow: 5201.051523, yellow_green: 13550.80096},
				*/
	
				/* 
				
				{ species: "Epifauna", red_yellow: 246661.1358, yellow_green: 252280.8541}, 
				{ species: "Scallops", red_yellow: 760965.9833, yellow_green: 793005.5252}, 
				{ species: "Grey seals", red_yellow: 3750.018328, yellow_green: 4783.0442}, 
				{ species: "Harbour seals", red_yellow: 765.3806708, yellow_green: 939.411679}, 
				{ species: "Phytoplankton", red_yellow: 1668677.984, yellow_green: 1673784.617}, 
				{ species: "Large zooplankton", red_yellow: 1782187.776, yellow_green: 1940606.686}, 
				{ species: "Small zooplankton", red_yellow: 805179.362, yellow_green: 807854.7059}, 
				{ species: "Infauna", red_yellow: 272054.1395, yellow_green: 273491.5966}, 
				{ species: "Algae", red_yellow: 466148.6321, yellow_green: 491761.0841}, 	
				*/
			];

			var tlthresh = [];
			for (var i = 0; i < traffic_light_thresholds.length; i++) {
				var species = traffic_light_thresholds[i].species;
				console.log('oop-'.species);
				tlthresh[species] = {};
				tlthresh[species].red_yellow = traffic_light_thresholds[i].red_yellow;
				tlthresh[species].yellow_green = traffic_light_thresholds[i].yellow_green;
			}		
		


			///////////////////////////////////////////
			// UTILITY FUNCTIONS

			// Make a key-value object
			var make_key_value = function(k, v) {
			  return { key: k,
					   value: v
					 };
			};

			// Join a key array with a data array.
			// Return an array of key-value objects.
			var merge = function(keys, values) {
			  var l = keys.length;
			  var d = [], v, k;
			  for(var i = 0; i < l; i++) {
				v = values[i].slice();
				k = keys[i];
				d.push( make_key_value( k, v ));
			  }
			  return d;
			};


			// Shuffles the input array.
			function shuffle(array) {
			  var m = array.length, t, i;
			  while (m) {
				i = Math.floor(Math.random() * m--);
				t = array[m], array[m] = array[i], array[i] = t;
			  }
			  return array;
			}

			// Returns a random integer between min and max
			// Using Math.round() will give you a non-uniform distribution!
			function get_random_int(min, max) {
			  return Math.floor(Math.random() * (max - min + 1)) + min;
			}

			// Resize the array, append random numbers if new_size is larger than array.
			function update_array(a, new_size) {

			  a = a || [];

			  if (a.length > new_size) {
				return a.slice(0, new_size);
			  }

			  var delta = new_size - a.length;
			  for(var i = 0; i < delta; i++) {
				a.push(get_random_int(0, 9));
			  }

			  return a;
			};


			function process_scenario(scenario, year) {
				var a = {};
				
				for (var i = 0; i < scenario.length; i++) {				
					for (var u = 0; i, u < scenario[i].ssb.length; u++) {
						//console.log(scenario[i]);
						//console.log(year + '=' + scenario[i].ssb[u][0]);
						if (scenario[i].ssb[u][0] == year) {
							var species = scenario[i].name;
							var colour = 'yellow'; 
							if (typeof tlthresh[species] != 'undefined') {
								if (scenario[i].ssb[u][1] < tlthresh[species].red_yellow) {
									colour = 'lightsalmon';
								}
								if (scenario[i].ssb[u][1]> tlthresh[species].yellow_green) {
									colour = 'lightgreen';
								}
							} else {
								colour = '#ccc';
							}
							//a = [nations[i].name, { val: nations[i].biomass[u][1], colour: colour } ];
							//row_data.push( a );
							a[scenario[i].name] = { val: scenario[i].ssb[u][1], colour: colour };
						}
					}			
				}	
				return a;
			}

			////////////////////////////////////////////////////////////
			// GENERATE DATA
			var alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

			var letter_to_data = {}; // store row data
			
			var row_data_alt_test;
			var cpg_test;
			
			var generate_data = function() {
				var i, j, a, l;
				
				var year = tlight.time.current;
				
				var row_data = [];
			
				var row_data_alt = [];
				//var nations = externaltl;
				
				//var nations = ;
				//current_path_good, fmey, gadoids
		
				var BAU = process_scenario(scenarioscollection['BAU'], year);
				//console.log(BAU);
				//alert(bop);
				var EnvState_optimization = process_scenario(scenarioscollection['EnvState_optimization'], year);			
				var MaxProfitAll = process_scenario(scenarioscollection['MaxProfitAll'], year);			
				var MaxProfitCod = process_scenario(scenarioscollection['MaxProfitCod'], year);			
				var MaxProfitPel = process_scenario(scenarioscollection['MaxProfitPel'], year);			
				var MaxYieldCod = process_scenario(scenarioscollection['MaxYieldCod'], year);			

				for(j=0; j < traffic_light_thresholds.length; j++) {
					species = traffic_light_thresholds[j].species;
					red_yellow = traffic_light_thresholds[j].red_yellow;
					yellow_green = traffic_light_thresholds[j].yellow_green;
					
				//for(species in cpg) {
					//console.log(species + " = " + cpg[species]);
					a = [species, 
						red_yellow,
						yellow_green, 
						BAU[species], 
						EnvState_optimization[species], 
						MaxProfitAll[species], 
						MaxProfitCod[species], 
						MaxProfitPel[species], 
						MaxYieldCod[species]
					];
					row_data.push( a );
				}		
		
				row_data_alt_test = row_data;
				cpg_test = BAU;
				
				//[{key: "G", value: [2, 8, 3]}, {key: "Z", value: [5, 4, 9]}, {key: "N", value: [0, 0, 5]}, {key: "V", value: [8, 0, 5]}, {key: "Y", value: [3, 7, 5]}, {key: "J", value: [3, 9, 4]}, {key: "P", value: [9, 8, 6]}, {key: "C", value: [7, 2, 5]}, {key: "B", value: [2, 5, 5]}, {key: "E", value: [2, 3, 4]}, …] (13)
		
				return row_data;
			};			


			

			/////////////////////////////////////////////
			// DEFINE HELPER FUNCTIONS
			// Extract key from key-value object.
			var get_key = function(d) { return d && d.key; };

			// Extract data from a key-value object.
			// Prepend the key so it is the first item in the values array.
			var extract_row_data = function(d) {

			  var values = d.value.slice();

			  // Prepend the key
			  values.unshift(d.key); 
			  return values;

			};

			// Use data as is.
			var ident = function(d) { return d; };


			/////////////////////////////////////////////
			// UPDATE THE TABLE

			// Select the table element
			var table = d3.select('#table_trafficlight');
			var thead = table.append('thead');
			var tbody = table.append('tbody');
			var theadrow = thead.append('tr');
			
			var columns = ['Species','Red-Yellow','Yellow-Green',
					'BAU',
					'EnvState_optimization', 
					'MaxProfitAll',
					'MaxProfitCod',
					'MaxProfitPel',
					'MaxYieldCod'];
				
			theadrow.selectAll('tr')
				.data(columns)
				.enter()
				.append('th')
				.style("background-color", '#fff')
				.style("border", '1px solid grey')
				.style("padding", '0px 3px 0px')
				.text(function (d) { return d })

			$('#table_trafficlight_wrapper').floatThead({
				position: 'fixed'
			});	

			$('#table_trafficlight').floatThead({
				position: 'fixed',
				top: 120
			});			
			
			// Define function to update data
			var update_table = function(new_data) {

				var rows = tbody.selectAll('tr').data(new_data);

				rows.enter()
					.append('tr')
					.selectAll("td")
					.data(function(row) {
						//console.log(row);
						return [{column: 'Species', value: row[0], textalign: 'left'},
								{column: 'Red-Yellow', value: row[1].toFixed(0)/1000.0, textalign: 'right'},
								{column: 'Yellow-Green', value: row[2].toFixed(0)/1000.0, textalign: 'right'},
								{column: 'BAU', value: row[3].val.toFixed(3), colour: row[3].colour, textalign: 'right'}, 
								{column: 'EnvState_optimization', value: row[4].val.toFixed(3), colour: row[4].colour, textalign: 'right'}, 
								{column: 'MaxProfitAll', value: row[5].val.toFixed(3), colour: row[5].colour, textalign: 'right'}, 
								{column: 'MaxProfitCod', value: row[6].val.toFixed(3), colour: row[6].colour, textalign: 'right'}, 
								{column: 'MaxProfitPel', value: row[7].val.toFixed(3), colour: row[7].colour, textalign: 'right'}, 
								{column: 'MaxYieldCod', value: row[8].val.toFixed(3), colour: row[8].colour, textalign: 'right'}];
						//return [{column: 'species', value: row[0]}, {column: 'biomass', value: row[1].val, colour: row[1].colour}, {column: 'colour' , value: row[1].colour}];
						/*
						return columns.map(function (column) {
							return { column: column, value: row[column] }
						})
						*/
					})
					.enter()
					.append("td")
					.style("background-color", function (d) { return d.colour || '#fff' })
					.style("text-align", function (d) { return d.textalign || 'right' })
					.style("border", '1px solid grey')
					.text(function(d) { return d.value; });

				rows.exit().remove();


				var cells = rows.selectAll('td')
				//.data(function (row) {return [row[0], row[1].val, row[1].colour];})
				.data(function(row) {
					return [{column: 'Species', value: row[0]},
								{column: 'Red-Yellow', value: row[1].toFixed(0)/1000.0},
								{column: 'Yellow-Green', value: row[2].toFixed(0)/1000.0},
								{column: 'BAU', value: row[3].val.toFixed(3), colour: row[3].colour}, 
								{column: 'EnvState_optimization', value: row[4].val.toFixed(3), colour: row[4].colour}, 
								{column: 'MaxProfitAll', value: row[5].val.toFixed(3), colour: row[5].colour}, 
								{column: 'MaxProfitCod', value: row[6].val.toFixed(3), colour: row[6].colour}, 
								{column: 'MaxProfitPel', value: row[7].val.toFixed(3), colour: row[7].colour}, 
								{column: 'MaxYieldCod', value: row[8].val.toFixed(3), colour: row[8].colour}];
					//return [{column: 'species', value: row[0]}, {column: 'biomass', value: row[1].val, colour: row[1].colour}, {column: 'colour' , value: row[1].colour}];
				})
				.style("background-color", function (d) { return d.colour || '#fff' })
				.text(function (d) {return d.value;});
		
				cells.enter()
				.append("td")
				.style("background-color", function (d) { return d.colour || '#fff' })
				.style("text-align", 'right')
					.style("border", '1px solid grey')
				.text(function(d) { return d.value + ' !'; });

				cells.exit().remove();
				

			};			
			

			var externaltl;
			
			var scenarioscollection = [];
			
			var q = d3.queue();
			q.defer(d3.json, 'dataOct2017/BAU-HSE-BAU-EwE.json')
			.defer(d3.json, 'dataOct2017/BAU-HSE-EnvState_optimization-EwE.json')
			.defer(d3.json, 'dataOct2017/BAU-HSE-MaxProfitAll-EwE.json')
			.defer(d3.json, 'dataOct2017/BAU-HSE-MaxProfitCod-EwE.json')
			.defer(d3.json, 'dataOct2017/BAU-HSE-MaxProfitPel-EwE.json')
			.defer(d3.json, 'dataOct2017/BAU-HSE-MaxYieldCod-EwE.json')
			.await(makeTrafficLights);

			function makeTrafficLights(error, BAU, EnvState_optimization, MaxProfitAll, MaxProfitCod, 
					MaxProfitPel, MaxYieldCod) {
				externaltl = BAU;	
				scenarioscollection['BAU'] = BAU;
				scenarioscollection['EnvState_optimization'] = EnvState_optimization;
				scenarioscollection['MaxProfitAll'] = MaxProfitAll;
				scenarioscollection['MaxProfitCod'] = MaxProfitCod;
				scenarioscollection['MaxProfitPel'] = MaxProfitPel;
				scenarioscollection['MaxYieldCod'] = MaxYieldCod;
					   
				inittrafficlight();
			}

			var tlight;
			
			var tlight = window.tlight || {};
			window.tlight = tlight;			
			
			function trafficlightupdate(v, duration) {
				tlight.time.current = v || tlight.time.current;
				//displayYear(1985 + dragit.time.current)
				d3.select("#trafficlight-slider-time").property("value", 1985 + tlight.time.current);
			}	

			function inittrafficlight() {
				tlight.time = {min: 1985, max: 2032, step: 1, current: 2032}
				
				//tlight.data = d3.range(nations.length).map(function () {
				//	return Array();
				//})
				/*
				nations.map(function (d) {
					if (d.name == "Grey seals" || d.name == "Harbour seals" || d.name == "Cetaceans" || d.name == "Seabirds" || d.name == "Poor cod" || d.name == "Large zooplankton" || d.name == "Small zooplankton" || d.name == "Infauna" || d.name == "Algae" || d.name == "Phytoplankton" || d.name == "Detritus") {
						$(".dot[name='" + d.name + "']").each(function () {
							$(this).attr("class", $(this).attr("class") + " hidden");
						});
					}
				});
				*/
			   
				//tlight.evt.register("trafficlightupdate", update);

				d3.select("#trafficlight-slider-time").property("value", tlight.time.current);

				trafficlightdisplayYear(tlight.time.current);

				d3.select("#trafficlight-slider-time")
					.on("input", function () {
						trafficlightdisplayYear(parseInt(this.value));
						//clear_demo();
						//console.log('inputyear:' + parseInt(this.value));
					})
					.on("change", function () {
						trafficlightdisplayYear(parseInt(this.value));
						//clear_demo();
						//console.log('changeyear:' + parseInt(this.value))
					})
					.on("mousedown", function () {
						speed = 10;
						//$(".icon-pause").click();
						//console.log('mousdownyear:' + parseInt(this.value))
					})

			}

			// Updates the display to show the specified year.
			function trafficlightdisplayYear(year) {
				tlight.time.current = year || tlight.time.current;
								
				if (externaltl.length > 0) {
					//console.log(generate_data());
					$("#trafficlight-year").html("Year: " + year);
					update_table(generate_data());
				}
				
				/*
				dot.data(interpolateData(year), key).call(position).sort(order);
				label.text(Math.floor(year));
				for (var i = 0; i < redundant_graphs_indicator.length; i++) {
					redundant_graphs_indicator[i].transition().duration(speed).ease("linear").attr("x1", redundant_graphs_xScale[i](year)).attr("x2", redundant_graphs_xScale[i](year));
				}
				*/
			}

		</script>		
		
	</body>
</html>
